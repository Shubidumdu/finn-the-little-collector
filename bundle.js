(()=>{"use strict";const t=new Map,e=t,i=t=>{t.width=window.innerWidth,t.height=window.innerHeight,(()=>{const t=document.querySelector('meta[name="viewport"]'),e=Math.round(visualViewport.scale*visualViewport.width),i=Math.round(visualViewport.scale*visualViewport.height);e<=460||i<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):e<=768||i<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()},s=t=>{const e=t.getContext("2d");return i=>{e.save(),e.beginPath(),i(e,t),e.closePath(),e.restore()}},a=t=>Math.PI/180*t,n=t=>Math.floor(Math.random()*t),o=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`,h=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,r=t=>t[n(t.length)];var c,l,d,f,w,p=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};const u=["#634e34","#2e536f","#1c7847"],y=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"];class m{constructor(){this.init=t=>{const{position:e,colors:i}=t;this.position=e,this.colors=i,this.isEnlarged=!1},this.update=t=>{this.draw(t)},this.remove=()=>{},this.draw=t=>{const i=e.get("layer1");s(i)(((e,i)=>{e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x+-2*this.sizeRatio,this.position.y+(26+2*Math.sin(t/64))*this.sizeRatio),e.rotate(a(-8*Math.sin(t/128))),p(this,l,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x,this.position.y+(24+2*Math.sin(t/128))*this.sizeRatio),p(this,d,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x,this.position.y+(63+2*Math.sin(t/128))*this.sizeRatio),p(this,f,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x,this.position.y+70*this.sizeRatio),e.rotate(a(14*Math.sin(t/128)-2)),p(this,w,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x+14*this.sizeRatio,this.position.y+70*this.sizeRatio),e.rotate(a(5+-14*Math.sin(t/128))),p(this,w,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x,this.position.y+2*Math.sin(t/128)*this.sizeRatio),p(this,c,"f").call(this,e),e.setTransform(this.sizeRatio,0,0,this.sizeRatio,this.position.x+18*this.sizeRatio,this.position.y+(26+2*Math.sin(t/64))*this.sizeRatio),e.rotate(a(8*Math.sin(t/128))),p(this,l,"f").call(this,e)}))},c.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(0,0,24,24),t.fillStyle=this.colors.eye,t.fillRect(4,8,4,4),t.fillRect(12,8,4,4),t.fillStyle=this.colors.hair,t.fillRect(-4,-8,28,12),t.fillRect(20,-4,6,20)})),l.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(0,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(0,38,8,8)})),d.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(0,0,24,40)})),f.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(0,0,24,12)})),w.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(0,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-2,23,12,8)}))}get sizeRatio(){return this.isEnlarged?1:.5}}c=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,w=new WeakMap;class v{constructor(){this.start=()=>{this.persons=[...new Array(100)].map((()=>new m)),this.persons.forEach((t=>{t.init({position:{x:n(this.layer1.width),y:n(this.layer1.height),z:0},colors:{hair:h(),eye:r(u),skin:r(y),top:h(),bottom:h(),shoe:h()}})}))},this.update=t=>{this.persons.forEach((e=>e.update(t)))},this.end=()=>{this.persons.forEach((t=>t.remove()))},this.persons=[],this.layer1=e.get("layer1")}}const g=new Proxy({isSoundOn:!1},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),Object.assign(R,Object.assign(Object.assign({},R),g)),!0)}),M=g,R=new Proxy(Object.assign({},M),{set:(t,e,i)=>(Object.assign(t,{[e]:i}),!0)});var k,b,x,z,T,S,W,E,O=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class P{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>O(this,T,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=R;(t=>{Object.assign(M,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,O(this,k,"f").call(this)},this.update=t=>{O(this,S,"f").call(this),O(this,W,"f").call(this),O(this,E,"f").call(this,t)},this.end=()=>{O(this,b,"f").call(this)},k.set(this,(()=>{window.addEventListener("keydown",(t=>{O(this,x,"f").call(this,t),O(this,z,"f").call(this,t)}))})),b.set(this,(()=>{window.removeEventListener("keydown",O(this,x,"f")),window.removeEventListener("keydown",O(this,z,"f"))})),x.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),z.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),T.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),S.set(this,(()=>{const t=e.get("layer1");s(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=o(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),W.set(this,(()=>{const t=e.get("layer1");s(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-20,e.height/2-100),t.font=o(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=o(12);const i=R.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${i} ]`,0,0):t.fillText(`Sound ${i}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),E.set(this,(t=>{const i=e.get("layer1");s(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width/2-100,i.height/2+40+2*Math.sin(t/60)),e.font=o(12),e.fillText("Press spacebar to act",0,0)}))}))}}k=new WeakMap,b=new WeakMap,x=new WeakMap,z=new WeakMap,T=new WeakMap,S=new WeakMap,W=new WeakMap,E=new WeakMap;var j,A,I,C,L=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};j=new WeakMap,A=new WeakMap,I=new WeakMap,C=new WeakMap,(e=>{if(t.has(e))return t.get(e);const s=Object.assign(document.createElement("canvas"),{id:e});t.set(e,s),document.body.appendChild(s),i(s),s.addEventListener("click",(t=>{t.stopPropagation(),window.postMessage({type:"click-canvas",payload:{id:e,x:t.clientX,y:t.clientY}},window.origin)})),window.addEventListener("resize",(()=>i(s)))})("layer1"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(L(this,I,"f")),L(this,C,"f").call(this)},j.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),A.set(this,(t=>{console.log("canvas click"),console.log(t)})),I.set(this,(e=>{console.log(e),[...t.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(e),requestAnimationFrame(L(this,I,"f"))})),C.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:e,payload:i}=t.data;switch(e){case"change-scene":L(this,j,"f").call(this,i);break;case"click-canvas":L(this,A,"f").call(this,i)}}))})),this.activeScene="title",this.scenes={play:new v,title:new P}}}).start()})();