(()=>{"use strict";const t=new Map,i=t;window.addEventListener("resize",(()=>{[...t.values()].map((t=>{s(t)})),(()=>{const t=document.querySelector('meta[name="viewport"]'),i=Math.round(visualViewport.scale*visualViewport.width),e=Math.round(visualViewport.scale*visualViewport.height);i<=460||e<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):i<=768||e<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()}));const e=i=>{if(t.has(i))return t.get(i);const e=Object.assign(document.createElement("canvas"),{id:i});return t.set(i,e),document.body.appendChild(e),s(e),e.addEventListener("click",(t=>{window.postMessage({type:"click-canvas",payload:{id:i,x:t.clientX,y:t.clientY}},window.origin)})),e},s=t=>{t.width=window.innerWidth,t.height=window.innerHeight},o=t=>{const i=t.getContext("2d");return e=>{i.save(),i.beginPath(),e(i,t),i.closePath(),i.restore()}},h=(t,i,e=0)=>{t.beginPath();const s=t.createLinearGradient(0,0,0,300);s.addColorStop(0,"#afe8f8"),s.addColorStop(.4,"#fff"),s.addColorStop(.5,"#fff"),s.addColorStop(1,"#cff7fd"),t.filter=`hue-rotate(${e}deg)`,t.fillStyle=s,t.fillRect(0,0,i.width,160),t.filter="none",t.closePath()};var a,n,r,l=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class c{constructor(){a.set(this,o(i.get("bg"))),this.init=()=>{},this.update=t=>{l(this,a,"f").call(this,((t,i)=>{t.setTransform(1,0,0,1,0,0),h(t,i),t.transform(1,0,0,1,0,160),l(this,n,"f").call(this,t,i),t.setTransform(1,0,0,1,0,240),l(this,r,"f").call(this,t,i),t.transform(1,0,0,1,0,10);const e=(i.height-480)/2;t.fillStyle="#0abb7d",t.fillRect(0,0,i.width,e),t.transform(1,0,0,1,0,e),t.fillStyle="#0cae75",t.fillRect(0,0,i.width,e),t.setTransform(1,0,-.5,1,i.width/2-280,240),t.beginPath(),t.strokeRect(0,0,800,600),t.closePath()}))},this.remove=()=>{l(this,a,"f").call(this,((t,i)=>{t.clearRect(0,0,i.width,i.height)}))},n.set(this,((t,i)=>{t.fillStyle="#f6fae6",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#e5fab3",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#d8fbb3",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#c0fb8e",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#c0fb8e",t.fillRect(0,0,i.width,20)})),r.set(this,((t,i)=>{t.beginPath(),t.fillStyle="#c04942",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,i.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,i.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,i.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,i.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,i.width,8)}))}}a=new WeakMap,n=new WeakMap,r=new WeakMap;var f,d,m,w=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class p{constructor(){f.set(this,o(i.get("bg"))),this.init=()=>{},this.update=t=>{w(this,f,"f").call(this,((t,i)=>{t.setTransform(1,0,0,1,0,0),h(t,i),t.transform(1,0,0,1,0,160),w(this,d,"f").call(this,t,i);const e=(i.height-340)/4;w(this,m,"f").call(this,t,i,e),t.setTransform(1,0,-.5,1,i.width/2-280,240),t.beginPath(),t.fillStyle="#fff",t.strokeRect(0,0,800,600),t.closePath()}))},this.remove=()=>{w(this,f,"f").call(this,((t,i)=>{t.clearRect(0,0,i.width,i.height)}))},d.set(this,((t,i)=>{t.fillStyle="#cff7fd",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#86f2f9",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#50effa",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#78ebfa",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#8ceffa",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#9ef8ff",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.globalAlpha=.8,t.fillStyle="#b4f9ff",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#d5f9f9",t.fillRect(0,0,i.width,20),t.transform(1,0,0,1,0,20),t.globalAlpha=.6,t.fillStyle="#dbfdfb",t.fillRect(0,0,i.width,20)})),m.set(this,((t,i,e)=>{t.fillStyle="#fffbf0",t.fillRect(0,0,i.width,e),t.transform(1,0,0,1,0,e),t.fillStyle="#f2efe7",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#f7f4ec",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#f2eee4",t.fillRect(0,0,i.width,e),t.transform(1,0,0,1,0,e),t.fillStyle="#eae8e3",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#ece8de",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#e1ded2",t.fillRect(0,0,i.width,e),t.transform(1,0,0,1,0,e),t.fillStyle="#d2cec5",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#eaede8",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10);const s=t.createLinearGradient(0,0,0,e);s.addColorStop(0,"#fcfff9"),s.addColorStop(1,"#ece8de"),t.fillStyle=s,t.fillRect(0,0,i.width,e)}))}}f=new WeakMap,d=new WeakMap,m=new WeakMap;const u=t=>Math.PI/180*t,y=({time:t,start:i,duration:e})=>{const s=(t-i)/e<0?0:(t-i)/e;return{isProgressing:s<1&&s>0,progress:s,isReserved:(t-i)/e<0,isEnded:(t-i)/e>1}},v=t=>Math.floor(Math.random()*t),g=(t=32,i="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${i}`,x=(t,i)=>Math.round(Math.random()*(i-t)+t),M=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,S=t=>t[v(t.length)],b=(t,i)=>`#${(parseInt(t.replace("#","0x"))+i).toString(16)}`,T=(t,i)=>{const{left:e,right:s,top:o,bottom:h}=i,{x:a,y:n}=t;return e<=a&&a<=s&&o<=n&&n<=h};var k,R=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class P{constructor(){k.set(this,o(i.get("bg"))),this.init=()=>{},this.update=t=>{R(this,k,"f").call(this,((t,i)=>{t.setTransform(1,0,0,1,0,0),h(t,i),t.transform(1,0,0,1,0,160);const e=Math.floor((i.height-160)/40/2)+2;for(let s=0;s<e;s++)t.fillStyle=b("#cccccc",197379*s),t.fillRect(0,0,i.width,40),t.transform(1,0,0,1,0,40);t.fillStyle="#d0d0d0",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#bdbdbd",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#7e7e7e",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#6f6f6f",t.fillRect(0,0,i.width,10),t.transform(1,0,0,1,0,10);for(let s=e;s<2*e+2;s++)t.fillStyle=b("#939393",197379*(e-s)),t.fillRect(0,0,i.width,40),t.transform(1,0,0,1,0,40);t.setTransform(1,0,0,1,0,160),t.fillStyle="#edda92",t.fillRect(0,40*(e-4),i.width,38),t.transform(1,0,0,1,0,40*(e-4)+38),t.fillStyle="#decc88",t.fillRect(0,0,i.width,2),t.setTransform(1,0,0,1,0,160),t.fillStyle="#fff",t.fillRect(0,40*(e+2),i.width,10),t.setTransform(1,0,-.5,1,i.width/2-280,240),t.beginPath(),t.strokeRect(0,0,800,600),t.closePath()}))},this.remove=()=>{R(this,k,"f").call(this,((t,i)=>{t.clearRect(0,0,i.width,i.height)}))}}}k=new WeakMap;var W,I,E,A=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class C{constructor(){this.init=({stage:t,timeout:i,lifeCount:e})=>{this.stage=t,this.timeout=i,this.lifeCount=e},this.remove=()=>{},this.update=t=>{this.startTime||(this.startTime=t),A(this,W,"f").call(this),A(this,I,"f").call(this,t),A(this,E,"f").call(this)},W.set(this,(()=>{o(this.layer)((t=>{t.setTransform(1,0,0,1,0,0),t.font=g(24),t.fillText(`Stage ${this.stage}`,40,56)}))})),I.set(this,(t=>{o(this.layer)(((i,e)=>{const s=(Math.max(this.timeout-(t-this.startTime),0)/1e3).toFixed(2);i.setTransform(1,0,0,1,e.width,0),i.font=g(24),i.fillText(s+"",-120,56)}))})),E.set(this,(()=>{const t=o(this.layer),i=Math.min(50,50);[...new Array(this.lifeCount)].forEach(((e,s)=>{t(((t,e)=>{t.strokeStyle="#000000",t.shadowOffsetX=4,t.shadowOffsetY=4,t.lineWidth=6,t.fillStyle="#FF0000",t.setTransform(1,0,0,1,40+80*s,e.height-100),t.moveTo(0,i/4),t.quadraticCurveTo(0,0,i/4,0),t.quadraticCurveTo(i/2,0,i/2,i/4),t.quadraticCurveTo(i/2,0,3*i/4,0),t.quadraticCurveTo(i,0,i,i/4),t.quadraticCurveTo(i,i/2,3*i/4,3*i/4),t.lineTo(i/2,i),t.lineTo(i/4,3*i/4),t.quadraticCurveTo(0,i/2,0,i/4),t.stroke(),t.fill()}))}))})),this.layer=i.get("layer3")}}W=new WeakMap,I=new WeakMap,E=new WeakMap;var B,O=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class L{constructor(){this.init=({position:t,range:i})=>{this.position=t,this.range=i,window.addEventListener("mousemove",O(this,B,"f"))},this.update=t=>{const i=o(this.layer1),e=o(this.layer2),s=o(this.layer3);i(((t,i)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-in",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),e(((t,i)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-out",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),s(((t,i)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.lineWidth=2,t.strokeStyle="#000",t.beginPath(),t.arc(0,0,this.range,0,2*Math.PI,!0),t.stroke()}))},this.remove=()=>{window.removeEventListener("mousemove",O(this,B,"f"))},B.set(this,(t=>{this.position={x:t.clientX,y:t.clientY}})),this.layer1=i.get("layer1"),this.layer2=i.get("layer2"),this.layer3=i.get("layer3")}}B=new WeakMap;var $,j,N,H,q,X,Y,z,F,V,D,G,K,U,J,Q,Z,_,tt,it,et,st,ot,ht,at,nt,rt=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};const lt=["#634e34","#2e536f","#1c7847"],ct=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"];class ft{constructor(t=.4){$.add(this),this.isHit=!1,this.correctAt=0,this.deadAt=0,this.init=t=>{const{id:i,position:e,colors:s}=t;this.id=i,this.position=e,this.move={direction:{x:Math.round(Math.random())?1:-1,y:Math.round(Math.random())?1:-1,z:1}},this.colors=s;const o=[...Array.from({length:12},(()=>rt(this,j,"f"))),...Array.from({length:4},(()=>rt(this,N,"f"))),...Array.from({length:24},(()=>rt(this,q,"f"))),...Array.from({length:8},(()=>rt(this,Y,"f"))),...Array.from({length:2},(()=>rt(this,F,"f"))),rt(this,X,"f"),rt(this,H,"f"),rt(this,z,"f"),rt(this,V,"f")],h=()=>Math.floor(x(0,o.length-1)),a=()=>{this.moves=[o[h()],o[h()]]},n=()=>{this.intervals=[x(4e3,7e3)]},r=()=>{this.randomX=x(-1,.3),this.randomY=x(-1,.3)},l=()=>{x(-1,1)>0&&rt(this,$,"m",ot).call(this),x(-1,1)>0&&rt(this,$,"m",st).call(this)};a(),n(),r(),setInterval((()=>{r(),n(),a()}),x(8e3,16e3)),setInterval((()=>{l()}),x(8e3,16e3))},this.update=t=>{if(this.draw(t),t%1e4<this.intervals[0]){const i=0+1e4*Math.floor(t/1e4),e=this.intervals[0];return void this.moves[0](y({time:t,start:i,duration:e}).progress)}const i=this.intervals[0]+1e4*Math.floor(t/1e4),e=1e4-this.intervals[0];this.moves[1](y({time:t,start:i,duration:e}).progress)},j.set(this,(()=>{this.isMoving=!1})),N.set(this,(()=>{this.isMoving=!0,rt(this,$,"m",it).call(this,this.defaultSpeed*(1+this.randomX)),rt(this,$,"m",et).call(this)})),H.set(this,(()=>{this.isMoving=!0,rt(this,$,"m",it).call(this,this.defaultSpeed*(1+this.randomX)),rt(this,$,"m",tt).call(this,this.defaultSpeed*(1+this.randomY)*.6),rt(this,$,"m",et).call(this)})),q.set(this,(()=>{this.isMoving=!0,rt(this,$,"m",it).call(this,this.defaultSpeed),rt(this,$,"m",tt).call(this,.2*this.defaultSpeed),rt(this,$,"m",et).call(this)})),X.set(this,(()=>{this.isMoving=!0,rt(this,$,"m",it).call(this,this.defaultSpeed),rt(this,$,"m",tt).call(this,1.2*this.defaultSpeed),rt(this,$,"m",et).call(this)})),Y.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;rt(this,$,"m",it).call(this,this.defaultSpeed*(1-t)),rt(this,$,"m",tt).call(this,.2*this.defaultSpeed*(1-t)),rt(this,$,"m",et).call(this)})),z.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;const i=Math.max(.8,t);rt(this,$,"m",it).call(this,this.defaultSpeed*(1-i)),rt(this,$,"m",tt).call(this,this.defaultSpeed*(1-i)),rt(this,$,"m",et).call(this)})),F.set(this,(t=>{this.isMoving=!0,rt(this,$,"m",it).call(this,this.defaultSpeed*(1+t)),rt(this,$,"m",tt).call(this,this.defaultSpeed*(1+t)*.2),rt(this,$,"m",et).call(this)})),V.set(this,(t=>{this.isMoving=!0;const i=Math.max(Math.min(.2,t),1);rt(this,$,"m",it).call(this,this.defaultSpeed*(1+i)),rt(this,$,"m",tt).call(this,this.defaultSpeed*(1+i)*.6),rt(this,$,"m",et).call(this)})),this.remove=()=>{},this.setIsHit=t=>{const{left:i,right:e,top:s,bottom:o}=this.hitBoxPosition,{x:h,y:a}=t;this.isHit=i<=h&&h<=e&&s<=a&&a<=o},this.draw=t=>{const e=i.get("layer1"),s=o(e),h=i.get("layer2"),a=o(h);s(((i,e)=>{const s=.6+this.position.z/e.height*.4;rt(this,Q,"f").call(this),rt(this,nt,"f").call(this,i,e,t,this.position,s),this.correctAt?rt(this,ht,"f").call(this,i,e,t,this.position,s):this.deadAt?rt(this,at,"f").call(this,i,e,t,this.position,s):(this.isHit&&rt(this,Z,"f").call(this,i,e,t,this.position,s),this.isMoving?this.drawMovement(i,e,t,this.position,s):this.drawIdle(i,e,t,this.position,s))})),a(((i,e)=>{const s=.3+this.position.z/e.height*.2;rt(this,nt,"f").call(this,i,e,t,this.position,s),this.correctAt||this.deadAt?rt(this,ht,"f").call(this,i,e,t,this.position,s):(rt(this,nt,"f").call(this,i,e,t,this.position,s),this.isHit&&rt(this,Z,"f").call(this,i,e,t,this.position,s),this.isMoving?this.drawMovement(i,e,t,this.position,s):this.drawIdle(i,e,t,this.position,s))}))},D.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(-12,-54,24,24),t.fillStyle=this.colors.eye,t.fillRect(-8,-46,4,4),t.fillRect(0,-46,4,4),t.fillStyle=this.colors.hair,t.fillRect(-16,-62,28,12),t.fillRect(8,-58,6,20)})),G.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(-12,38,8,8)})),K.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,-54,24,40)})),U.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,-54,24,12)})),J.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-14,23,12,8)})),Q.set(this,(()=>{this.hitBoxPosition={left:this.position.x-13.5,width:27,right:this.position.x+13.5,top:this.position.y-35-3,height:70,bottom:this.position.y+35}})),Z.set(this,((t,i,e,s,o)=>{t.setTransform(o,0,0,o,s.x,s.y+(2*Math.sin(e/128)-74)*o),t.strokeStyle="#b6d9e9",t.beginPath(),t.ellipse(0,0,12,5,Math.PI,0,2*Math.PI),t.lineWidth=3,t.stroke(),t.strokeStyle="#fff",t.beginPath(),t.ellipse(0,0,10,5,Math.PI,0,2*Math.PI),t.lineWidth=3,t.stroke()})),_.set(this,((t,{isRect:i})=>{if(t.fillStyle="#fff",i)return t.fillRect(this.hitBoxPosition.left,this.hitBoxPosition.top,this.hitBoxPosition.width,this.hitBoxPosition.height),void t.fill();t.ellipse(this.position.x,this.position.y-5,35,55,Math.PI,0,2*Math.PI),t.fill()})),ht.set(this,((t,i,e,s,o)=>{const{isProgressing:h,progress:a}=y({time:e,start:this.correctAt,duration:500});if(!h||a<0)return;const n=Math.cos((1-a)*Math.PI*(2/3));t.setTransform(o,0,0,o,s.x,s.y+-74*o),t.scale(2,1),t.arc(0,120,24*Math.sin(a*Math.PI),0,u(360)),t.fillStyle="#000",t.fill(),t.filter=`opacity(${100*(1-n)}%) hue-rotate(${180*n}deg)`,t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(80*n-28)*o),rt(this,G,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x,s.y+(24+28*n)*o),rt(this,K,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x,s.y+(63+-11*n)*o),rt(this,U,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x,s.y+(16+36*n)*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+(16+36*n)*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x,s.y+52*n*o),rt(this,D,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-n),s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(80*n-28)*o),rt(this,G,"f").call(this,t)})),at.set(this,((t,i,e,s,o)=>{const{isProgressing:h,progress:a}=y({time:e,start:this.deadAt,duration:200});!h||a<0||(t.setTransform(o,0,0,o,s.x,s.y+-74*o),t.filter=`grayscale(${100*a}%) opacity(${100*(1-a)}%)`,t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(-28+Math.sin(e/128))*o),rt(this,G,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+Math.sin(e/128))*o),rt(this,K,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+Math.sin(e/128))*o),rt(this,U,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+Math.sin(e/128)*o),rt(this,D,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(-28+Math.sin(e/128))*o),rt(this,G,"f").call(this,t))})),nt.set(this,((t,i,e,s,o)=>{const h=y({time:e,start:this.deadAt,duration:200});h.isEnded&&this.deadAt||this.correctAt||(t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+44*o),t.scale(2,1),t.arc(0,0,18,0,u(360)),t.fillStyle=h.isProgressing?`rgba(0, 0, 0, ${.1*(1-h.progress)})`:"rgba(0, 0, 0, 0.1)",t.fill())})),this.defaultSpeed=t}drawIdle(t,i,e,s,o){t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(-28+Math.sin(e/128))*o),rt(this,G,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+Math.sin(e/128))*o),rt(this,K,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+Math.sin(e/128))*o),rt(this,U,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+Math.sin(e/128)*o),rt(this,D,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(-28+Math.sin(e/128))*o),rt(this,G,"f").call(this,t)}drawMovement(t,i,e,s,o){t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(2*Math.sin(e/64)-28)*o),t.rotate(u(-8*Math.sin(e/128))),rt(this,G,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+2*Math.sin(e/128))*o),rt(this,K,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+2*Math.sin(e/128))*o),rt(this,U,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),t.rotate(u(14*Math.sin(e/128)-2)),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),t.rotate(u(5+-14*Math.sin(e/128))),rt(this,J,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+2*Math.sin(e/128)*o),rt(this,D,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(2*Math.sin(e/64)-28)*o),t.rotate(u(8*Math.sin(e/128))),rt(this,G,"f").call(this,t)}}j=new WeakMap,N=new WeakMap,H=new WeakMap,q=new WeakMap,X=new WeakMap,Y=new WeakMap,z=new WeakMap,F=new WeakMap,V=new WeakMap,D=new WeakMap,G=new WeakMap,K=new WeakMap,U=new WeakMap,J=new WeakMap,Q=new WeakMap,Z=new WeakMap,_=new WeakMap,ht=new WeakMap,at=new WeakMap,nt=new WeakMap,$=new WeakSet,tt=function(t){this.position.y=this.position.y+t*this.move.direction.y},it=function(t){this.position.x=this.position.x+t*this.move.direction.x},et=function(){(this.position.x<-20||this.position.x>=document.body.clientWidth)&&rt(this,$,"m",ot).call(this),(this.position.y<-10||this.position.y>=document.body.clientHeight)&&rt(this,$,"m",st).call(this)},st=function(){this.move.direction.y=-1*this.move.direction.y},ot=function(){this.move.direction.x=-1*this.move.direction.x};const dt=new Proxy({isSoundOn:!1},{set:(t,i,e)=>(Object.assign(t,{[i]:e}),Object.assign(wt,{...wt,...dt}),!0)}),mt=dt,wt=new Proxy({...mt},{set:(t,i,e)=>(Object.assign(t,{[i]:e}),!0)}),pt=(...t)=>vt(gt(...t)),ut=44100,yt=new(window.AudioContext||webkitAudioContext),vt=(...t)=>{let i=yt.createBuffer(t.length,t[0].length,ut),e=yt.createBufferSource();return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(yt.destination),e.start(),e},gt=(t=1,i=.05,e=220,s=0,o=0,h=.1,a=0,n=1,r=0,l=0,c=0,f=0,d=0,m=0,w=0,p=0,u=0,y=1,v=0,g=0)=>{let x,M,S=2*Math.PI,b=r*=500*S/ut/ut,T=e*=(1+2*i*Math.random()-i)*S/ut,k=[],R=0,P=0,W=0,I=1,E=0,A=0,C=0;for(l*=500*S/ut**3,w*=S/ut,c*=S/ut,f*=ut,d=d*ut|0,M=(s=s*ut+9)+(v*=ut)+(o*=ut)+(h*=ut)+(u*=ut)|0;W<M;k[W++]=C)++A%(100*p|0)||(C=a?a>1?a>2?a>3?Math.sin((R%S)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/S%2+2)%2:1-4*Math.abs(Math.round(R/S)-R/S):Math.sin(R),C=(d?1-g+g*Math.sin(S*W/d):1)*(C>0?1:-1)*Math.abs(C)**n*t*.2*(W<s?W/s:W<s+v?1-(W-s)/v*(1-y):W<s+v+o?y:W<M-u?(M-W-u)/h*y:0),C=u?C/2+(u>W?0:(W<M-u?1:(M-W)/u)*k[W-u|0]/2):C),x=(e+=r+=l)*Math.cos(w*P++),R+=x-x*m*(1-1e9*(Math.sin(W)+1)%2),I&&++I>f&&(e+=c,T+=c,I=0),!d||++E%d||(e=T,r=b,I=I||1);return k},xt=t=>{if(wt.isSoundOn)switch(t){case"pick":pt(...[.3,,1384,.02,.01,0,,1.36,8.5,,,,,,15,,,,.01]);break;case"correct":pt(...[.4,.01,496,.05,.21,.47,,1.42,,-4.7,146,.1,.15,,,,.12,.76,.11,.28]);break;case"wrong":pt(...[.4,,455,,.07,.07,,.09,,-.2,,,.04,.8,33,.4,.29,.85,.09])}};var Mt,St,bt,Tt,kt,Rt,Pt,Wt=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class It{constructor(){this.init=t=>{const{persons:i}=t;this.persons=i,this.selectedIndex=0,window.addEventListener("keydown",Wt(this,kt,"f"))},this.update=t=>{this.draw(t)},this.remove=()=>{window.removeEventListener("keydown",Wt(this,kt,"f"))},this.draw=t=>{const e=i.get("layer3");o(e)(((i,e)=>{if(i.setTransform(1,0,0,1,e.width-120,e.height-170),Wt(this,Mt,"f").call(this,i),!this.persons.length)return;const s=this.persons[this.selectedIndex];s.isMoving?s.drawMovement(i,e,t,{x:e.width-70,y:e.height-85},1):s.drawIdle(i,e,t,{x:e.width-70,y:e.height-85},1),i.setTransform(1,0,0,1,e.width-26,e.height-110),Wt(this,St,"f").call(this,i),i.setTransform(1,0,0,1,e.width-113,e.height-110),Wt(this,bt,"f").call(this,i),i.setTransform(1,0,0,1,e.width-74,e.height-180),Wt(this,Tt,"f").call(this,i)}))},Mt.set(this,(t=>{t.strokeStyle="#000",t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.8)",t.strokeRect(0,0,100,150),t.fillRect(0,0,100,150)})),St.set(this,(t=>{t.fillStyle="#000",t.beginPath(),t.moveTo(0,0),t.lineTo(15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=g(8),t.fillStyle="#fff",t.fillText("S",1,18)})),bt.set(this,(t=>{t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.moveTo(0,0),t.lineTo(-15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=g(8),t.fillStyle="#fff",t.fillText("A",-10,18)})),Tt.set(this,(t=>{t.font=g(16),t.textAlign="center",t.fillStyle="#000",t.fillText(`${this.selectedIndex+1} / ${this.persons.length}`,0,0,100)})),kt.set(this,(t=>{"KeyA"===t.code&&(xt("pick"),Wt(this,Rt,"f").call(this)),"KeyS"===t.code&&(xt("pick"),Wt(this,Pt,"f").call(this))})),Rt.set(this,(()=>{0===this.selectedIndex?this.selectedIndex=this.persons.length-1:this.selectedIndex-=1})),Pt.set(this,(()=>{this.selectedIndex===this.persons.length-1?this.selectedIndex=0:this.selectedIndex+=1})),this.removePerson=t=>{this.persons=this.persons.filter((i=>i.id!==t)),this.selectedIndex=0}}}Mt=new WeakMap,St=new WeakMap,bt=new WeakMap,Tt=new WeakMap,kt=new WeakMap,Rt=new WeakMap,Pt=new WeakMap;const Et=class{constructor(t){this.play=(t=!1)=>{wt.isSoundOn&&(this.player=vt(...this.buffer),this.player.loop=t)},this.stop=()=>{this.player?.stop()},this.buffer=((t,i,e,s=125)=>{let o,h,a,n,r,l,c,f,d,m,w,p,u,y,v,g=0,x=[],M=[],S=[],b=0,T=0,k=1,R={},P=ut/s*60>>2;for(;k;b++)x=[k=f=w=u=0],e.map(((s,w)=>{for(c=i[s][b]||[0,0,0],k|=!!i[s][b],v=u+(i[s][0].length-2-!f)*P,y=w==e.length-1,h=2,n=u;h<c.length+y;f=++h){for(r=c[h],d=h==c.length+y-1&&y||m!=(c[0]||0)|r|0,a=0;a<P&&f;a++>P-99&&d?p+=(p<1)/99:0)l=(1-p)*x[g++]/2||0,M[n]=(M[n]||0)-l*T+l,S[n]=(S[n++]||0)+l*T+l;r&&(p=r%1,T=c[1]||0,(r|=0)&&(x=R[[m=c[g=0]||0,r]]=R[[m,r]]||(o=[...t[m]],o[2]*=2**((r-12)/12),r>0?gt(...o):[])))}u=v}));return[M,S]})(...t)}},At=[[[.4,0,232,.01,.09,.15,,,,,,,154.87,,,,.26],[.1,0,900,.02,,.07,4,0,,,,,,4],[.2,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.3,0,42,,.08,.18,1]],[[[,-.5,12,,,,24,,,22,,,,,18,,22,,12,,,,24,,,22,,,,,25,,27,,12,,,,24,,,22,,,16,,15,,20,,12,,,,24,,,22,,20,,18,,16,,20],[1,-.3,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,29,32,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,29,32,29,32],[2,.3,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,13,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,13,,],[3,.5,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30]]],[0],62];class Ct{constructor(){this.music=new Et(At),this.start=()=>{this.backgrounds[this.activeBackground].init(),this.music.play(!0),this.info.init({stage:1,timeout:1e4,lifeCount:5}),this.persons=[...new Array(100)].map((()=>new ft)),this.persons.forEach(((t,i)=>{t.init({id:i,position:{x:v(this.layer1.width),y:v(this.layer1.height),z:0},colors:{hair:M(),eye:S(lt),skin:S(ct),top:M(),bottom:M(),shoe:M()}})})),this.magnifier.init({position:{x:0,y:0},range:100});const t=this.persons.filter((t=>t.id<3));this.wantedPoster.init({persons:[...t]}),window.addEventListener("click",(t=>{let i=!1,e=!1;this.persons.forEach((s=>{s.isHit||(s.setIsHit({x:t.clientX,y:t.clientY}),s.isHit&&(i=!0,s.id<3?(e=!0,this.wantedPoster.removePerson(s.id),s.correctAt=performance.now()):s.deadAt=performance.now()))})),i&&(e?xt("correct"):(xt("wrong"),this.info.lifeCount=Math.max(0,this.info.lifeCount-1)))}))},this.update=t=>{this.backgrounds[this.activeBackground].update(t),this.info.update(t),this.persons.forEach((i=>{i.update(t)})),this.magnifier.update(t),this.wantedPoster.update(t)},this.end=()=>{this.backgrounds[this.activeBackground].remove(),this.music.stop(),this.info.remove(),this.persons.forEach((t=>t.remove()))},this.activeBackground="road",this.backgrounds={playground:new c,pool:new p,road:new P},this.info=new C,this.magnifier=new L,this.persons=[],this.layer1=i.get("layer1"),this.wantedPoster=new It}}const Bt=[[[.2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.4],[.2,0,640,.01,.12,.24,1,.8,-.1,,-10,.2,,.8,,,.08,.8],[.2,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.3,0,219,,,,,1.1,,-.1,-50,-.05,-.01,1],[.2,0,22,,.08,.08,3,12,,,,,.02,,,,.01]],[[[1,-.3,10,,,,13,,10,,,,10,,13,,10,,,,10,,13,,10,,15,,10,,13,,10,,,,10,,13,,10,,,,10,,15,,10,,,,10,,13,,15,,17,,15,,13,,10,,],[2,-.5,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,],[,.5,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,],[3,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,20,20],[4,.4,22,,,,22,,20,22,,,,,22,,20,22,,,,,22,,25,22,,,,,22,,20,22,,,,,22,,20,22,,,,,22,,20,22,,,,,22,,25,29,,,,,32,,25,27]]],[0],100];var Ot,Lt,$t,jt,Nt,Ht,qt,Xt,Yt,zt=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class Ft{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>zt(this,Nt,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=wt;(t=>{Object.assign(mt,{isSoundOn:t})})(!t),wt.isSoundOn?this.music.play(!0):this.music.stop()}}],this.music=new Et(Bt),this.hitBoxes={start:{},sound:{}},this.start=()=>{this.activeMenuIndex=0,zt(this,Ot,"f").call(this),this.music.play(!0)},this.update=t=>{zt(this,Ht,"f").call(this),zt(this,qt,"f").call(this),zt(this,Xt,"f").call(this,t)},this.end=()=>{zt(this,Lt,"f").call(this),this.music.stop()},Ot.set(this,(()=>{window.addEventListener("keydown",zt(this,$t,"f")),window.addEventListener("keydown",zt(this,jt,"f")),window.addEventListener("click",(t=>{const{clientX:i,clientY:e}=t;T({x:i,y:e},this.hitBoxes.start)&&(this.activeMenuIndex=0,this.menus[this.activeMenuIndex].action()),T({x:i,y:e},this.hitBoxes.sound)&&(this.activeMenuIndex=1,this.menus[this.activeMenuIndex].action())}))})),Lt.set(this,(()=>{window.removeEventListener("keydown",zt(this,$t,"f")),window.removeEventListener("keydown",zt(this,jt,"f"))})),$t.set(this,(t=>{xt("pick"),"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),jt.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),Nt.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),Ht.set(this,(()=>{const t=i.get("layer1");o(t)(((t,i)=>{t.setTransform(1,0,0,1,i.width/2-172,i.height/2-200),t.font=g(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),qt.set(this,(()=>{const t=i.get("layer1");o(t)(((t,i)=>{const e={x:i.width/2-20,y:i.height/2-100},s=e.x+-20,o=e.y+40;this.hitBoxes.start={left:e.x-3,width:51,right:e.x-3+51,top:e.y-18+3,height:18,bottom:e.y-18+3+18},this.hitBoxes.sound={left:s-3,width:110,right:s-3+110,top:o-18+3,height:18,bottom:o-18+3+18},t.setTransform(1,0,0,1,e.x,e.y),t.font=g(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=g(12);const h=wt.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${h} ]`,0,0):t.fillText(`Sound ${h}`,0,0),t.setTransform(1,0,0,1,i.width/2-100,i.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),Xt.set(this,(t=>{const e=i.get("layer1");o(e)(((i,e)=>{i.setTransform(1,0,0,1,e.width/2-100,e.height/2+40+2*Math.sin(t/60)),i.font=g(12),i.fillText("Press spacebar to act",0,0)}))})),Yt.set(this,(t=>{t.fillStyle="white",t.fillRect(this.hitBoxes.start.left,this.hitBoxes.start.top,this.hitBoxes.start.width,this.hitBoxes.start.height),t.fillRect(this.hitBoxes.sound.left,this.hitBoxes.sound.top,this.hitBoxes.sound.width,this.hitBoxes.sound.height),t.fillStyle="#000"}))}}Ot=new WeakMap,Lt=new WeakMap,$t=new WeakMap,jt=new WeakMap,Nt=new WeakMap,Ht=new WeakMap,qt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap;var Vt,Dt,Gt,Kt,Ut=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};Vt=new WeakMap,Dt=new WeakMap,Gt=new WeakMap,Kt=new WeakMap,e("layer1"),e("layer2"),e("layer3"),e("bg"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(Ut(this,Gt,"f")),Ut(this,Kt,"f").call(this)},Vt.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),Dt.set(this,(t=>{console.log("canvas click"),console.log(t)})),Gt.set(this,(i=>{[...t.values()].map((t=>(t=>{const i=t.getContext("2d");return()=>{i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(i),requestAnimationFrame(Ut(this,Gt,"f"))})),Kt.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:i,payload:e}=t.data;switch(i){case"change-scene":Ut(this,Vt,"f").call(this,e);break;case"click-canvas":Ut(this,Dt,"f").call(this,e)}}))})),this.activeScene="title",this.scenes={play:new Ct,title:new Ft}}}).start()})();