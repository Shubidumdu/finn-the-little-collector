(()=>{"use strict";const t=new Map,e=new Proxy({isSoundOn:!1},{set:(t,s,i)=>(Object.assign(t,{[s]:i}),Object.assign(a,Object.assign(Object.assign({},a),e)),!0)}),s=e,i={canvas:t},a=new Proxy(Object.assign(Object.assign({},s),i),{set:(t,e,s)=>(e in i||Object.assign(t,{[e]:s}),!0)}),n=t=>{t.width=window.innerWidth,t.height=window.innerHeight,(()=>{const t=document.querySelector("meta[name='viewport']"),e=Math.round(visualViewport.scale*visualViewport.width),s=Math.round(visualViewport.scale*visualViewport.height);e<=460||s<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):e<=768||s<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()},h=t=>{const e=t.getContext("2d");return s=>{e.save(),e.beginPath(),s(e,t),e.closePath(),e.restore()}},c=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`;var o,r,l,d,w,f=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};class p{constructor(){this.init=t=>{const{position:e}=t;this.position=e},this.update=t=>{this.draw(t)},this.remove=()=>{},this.draw=t=>{const e=a.canvas.get("layer1");h(e)(((e,s)=>{e.setTransform(1,0,0,1,s.width/2-4,s.height/2+26+1*Math.sin(t/128)),f(this,r,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2,s.height/2+24+1*Math.sin(t/128)),f(this,l,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2,s.height/2+62),f(this,d,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2,s.height/2+73),f(this,w,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2+14,s.height/2+73),f(this,w,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2+20,s.height/2+26+1*Math.sin(t/128)),f(this,r,"f").call(this,e),e.setTransform(1,0,0,1,s.width/2,s.height/2+2*Math.sin(t/128)),f(this,o,"f").call(this,e)}))},o.set(this,(t=>{t.fillStyle="#ffefdb",t.fillRect(0,0,24,24),t.fillStyle="#00aeff",t.fillRect(4,8,4,4),t.fillRect(12,8,4,4),t.fillStyle="#ffcc00",t.fillRect(-4,-8,28,12),t.fillRect(20,-4,6,20)})),r.set(this,(t=>{t.fillStyle="#de0034",t.fillRect(0,0,8,38),t.fillStyle="#ffefdb",t.fillRect(0,38,8,8)})),l.set(this,(t=>{t.fillStyle="#de0034",t.fillRect(0,0,24,40)})),d.set(this,(t=>{t.fillStyle="#075aa3",t.fillRect(0,0,24,12)})),w.set(this,(t=>{t.fillStyle="#075aa3",t.fillRect(0,0,10,24),t.fillStyle="#000",t.fillRect(-2,23,12,8)}))}}o=new WeakMap,r=new WeakMap,l=new WeakMap,d=new WeakMap,w=new WeakMap;class u{constructor(){this.start=()=>{this.person.init({position:{x:0,y:0,z:0}})},this.update=t=>{this.person.update(t)},this.end=()=>{this.person.remove()},this.person=new p}}var v,g,m,y,M,k,b,T,S=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};class x{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>S(this,M,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=a;(t=>{Object.assign(s,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,S(this,v,"f").call(this)},this.update=t=>{S(this,k,"f").call(this),S(this,b,"f").call(this),S(this,T,"f").call(this,t)},this.end=()=>{S(this,g,"f").call(this)},v.set(this,(()=>{window.addEventListener("keydown",(t=>{S(this,m,"f").call(this,t),S(this,y,"f").call(this,t)}))})),g.set(this,(()=>{window.removeEventListener("keydown",S(this,m,"f")),window.removeEventListener("keydown",S(this,y,"f"))})),m.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),y.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),M.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),k.set(this,(()=>{const t=a.canvas.get("layer1");h(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=c(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),b.set(this,(()=>{const t=a.canvas.get("layer1");h(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-20,e.height/2-100),t.font=c(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=c(12);const s=a.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${s} ]`,0,0):t.fillText(`Sound ${s}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),T.set(this,(t=>{const e=a.canvas.get("layer1");h(e)(((e,s)=>{e.setTransform(1,0,0,1,s.width/2-100,s.height/2+40+2*Math.sin(t/60)),e.font=c(12),e.fillText("Press spacebar to act",0,0)}))}))}}v=new WeakMap,g=new WeakMap,m=new WeakMap,y=new WeakMap,M=new WeakMap,k=new WeakMap,b=new WeakMap,T=new WeakMap;var W,E,O,R,j=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};W=new WeakMap,E=new WeakMap,O=new WeakMap,R=new WeakMap,(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(j(this,O,"f")),j(this,R,"f").call(this)},W.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),E.set(this,(t=>{console.log("canvas click"),console.log(t)})),O.set(this,(t=>{console.log(t),[...a.canvas.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(t),requestAnimationFrame(j(this,O,"f"))})),R.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:e,payload:s}=t.data;switch(e){case"change-scene":j(this,W,"f").call(this,s);break;case"click-canvas":j(this,E,"f").call(this,s)}}))})),this.activeScene="title",this.scenes={play:new u,title:new x},(t=>{if(a.canvas.has(t))return a.canvas.get(t);const e=Object.assign(document.createElement("canvas"),{id:t});a.canvas.set(t,e),document.body.appendChild(e),n(e),e.addEventListener("click",(e=>{e.stopPropagation(),window.postMessage({type:"click-canvas",payload:{id:t,x:e.clientX,y:e.clientY}},window.origin)})),window.addEventListener("resize",(()=>n(e)))})("layer1")}}).start()})();