(()=>{"use strict";const t=new Map,e=t,i=t=>{t.width=window.innerWidth,t.height=window.innerHeight,(()=>{const t=document.querySelector('meta[name="viewport"]'),e=Math.round(visualViewport.scale*visualViewport.width),i=Math.round(visualViewport.scale*visualViewport.height);e<=460||i<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):e<=768||i<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()},s=t=>{const e=t.getContext("2d");return i=>{e.save(),e.beginPath(),i(e,t),e.closePath(),e.restore()}},a=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`;var n,h,o,c,r,l=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class d{constructor(){this.init=t=>{const{position:e}=t;this.position=e},this.update=t=>{this.draw(t)},this.remove=()=>{},this.draw=t=>{const i=e.get("layer1");s(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width/2-4,i.height/2+26+1*Math.sin(t/128)),l(this,h,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2,i.height/2+24+1*Math.sin(t/128)),l(this,o,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2,i.height/2+62),l(this,c,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2,i.height/2+73),l(this,r,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2+14,i.height/2+73),l(this,r,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2+20,i.height/2+26+1*Math.sin(t/128)),l(this,h,"f").call(this,e),e.setTransform(1,0,0,1,i.width/2,i.height/2+2*Math.sin(t/128)),l(this,n,"f").call(this,e)}))},n.set(this,(t=>{t.fillStyle="#ffefdb",t.fillRect(0,0,24,24),t.fillStyle="#00aeff",t.fillRect(4,8,4,4),t.fillRect(12,8,4,4),t.fillStyle="#ffcc00",t.fillRect(-4,-8,28,12),t.fillRect(20,-4,6,20)})),h.set(this,(t=>{t.fillStyle="#de0034",t.fillRect(0,0,8,38),t.fillStyle="#ffefdb",t.fillRect(0,38,8,8)})),o.set(this,(t=>{t.fillStyle="#de0034",t.fillRect(0,0,24,40)})),c.set(this,(t=>{t.fillStyle="#075aa3",t.fillRect(0,0,24,12)})),r.set(this,(t=>{t.fillStyle="#075aa3",t.fillRect(0,0,10,24),t.fillStyle="#000",t.fillRect(-2,23,12,8)}))}}n=new WeakMap,h=new WeakMap,o=new WeakMap,c=new WeakMap,r=new WeakMap;class w{constructor(){this.start=()=>{this.person.init({position:{x:0,y:0,z:0}})},this.update=t=>{this.person.update(t)},this.end=()=>{this.person.remove()},this.person=new d}}const f=new Proxy({isSoundOn:!1},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),Object.assign(u,Object.assign(Object.assign({},u),f)),!0)}),p=f,u=new Proxy(Object.assign({},p),{set:(t,e,i)=>(Object.assign(t,{[e]:i}),!0)});var v,g,m,y,M,k,b,T,S=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class x{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>S(this,M,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=u;(t=>{Object.assign(p,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,S(this,v,"f").call(this)},this.update=t=>{S(this,k,"f").call(this),S(this,b,"f").call(this),S(this,T,"f").call(this,t)},this.end=()=>{S(this,g,"f").call(this)},v.set(this,(()=>{window.addEventListener("keydown",(t=>{S(this,m,"f").call(this,t),S(this,y,"f").call(this,t)}))})),g.set(this,(()=>{window.removeEventListener("keydown",S(this,m,"f")),window.removeEventListener("keydown",S(this,y,"f"))})),m.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),y.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),M.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),k.set(this,(()=>{const t=e.get("layer1");s(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=a(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),b.set(this,(()=>{const t=e.get("layer1");s(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-20,e.height/2-100),t.font=a(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=a(12);const i=u.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${i} ]`,0,0):t.fillText(`Sound ${i}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),T.set(this,(t=>{const i=e.get("layer1");s(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width/2-100,i.height/2+40+2*Math.sin(t/60)),e.font=a(12),e.fillText("Press spacebar to act",0,0)}))}))}}v=new WeakMap,g=new WeakMap,m=new WeakMap,y=new WeakMap,M=new WeakMap,k=new WeakMap,b=new WeakMap,T=new WeakMap;var W,E,R,O,j=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};W=new WeakMap,E=new WeakMap,R=new WeakMap,O=new WeakMap,(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(j(this,R,"f")),j(this,O,"f").call(this)},W.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),E.set(this,(t=>{console.log("canvas click"),console.log(t)})),R.set(this,(e=>{console.log(e),[...t.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(e),requestAnimationFrame(j(this,R,"f"))})),O.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:e,payload:i}=t.data;switch(e){case"change-scene":j(this,W,"f").call(this,i);break;case"click-canvas":j(this,E,"f").call(this,i)}}))})),this.activeScene="title",this.scenes={play:new w,title:new x},(e=>{if(t.has(e))return t.get(e);const s=Object.assign(document.createElement("canvas"),{id:e});t.set(e,s),document.body.appendChild(s),i(s),s.addEventListener("click",(t=>{t.stopPropagation(),window.postMessage({type:"click-canvas",payload:{id:e,x:t.clientX,y:t.clientY}},window.origin)})),window.addEventListener("resize",(()=>i(s)))})("layer1")}}).start()})();