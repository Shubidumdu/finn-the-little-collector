(()=>{"use strict";const t=new Map,i=t,e=i=>{if(t.has(i))return t.get(i);const e=Object.assign(document.createElement("canvas"),{id:i});return t.set(i,e),document.body.appendChild(e),s(e),e.addEventListener("click",(t=>{t.stopPropagation(),window.postMessage({type:"click-canvas",payload:{id:i,x:t.clientX,y:t.clientY}},window.origin)})),window.addEventListener("resize",(()=>s(e))),e},s=t=>{t.width=window.innerWidth,t.height=window.innerHeight,(()=>{const t=document.querySelector('meta[name="viewport"]'),i=Math.round(visualViewport.scale*visualViewport.width),e=Math.round(visualViewport.scale*visualViewport.height);i<=460||e<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):i<=768||e<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()},n=t=>{const i=t.getContext("2d");return e=>{i.save(),i.beginPath(),e(i,t),i.closePath(),i.restore()}};var a,o=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class h{constructor(){this.init=({position:t,range:i})=>{this.position=t,this.range=i,window.addEventListener("mousemove",o(this,a,"f"))},this.update=t=>{const i=n(this.layer1),e=n(this.layer2);i(((t,i)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-in",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),e(((t,i)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-out",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()}))},this.remove=()=>{window.removeEventListener("mousemove",o(this,a,"f"))},a.set(this,(t=>{this.position={x:t.clientX,y:t.clientY}})),this.layer1=i.get("layer1"),this.layer2=i.get("layer2")}}a=new WeakMap;const r=t=>Math.PI/180*t,l=({time:t,start:i,duration:e})=>{const s=(t-i)/e<0?0:(t-i)/e;return{isProgressing:s<1&&s>0,progress:s,isReserved:(t-i)/e<0,isEnded:(t-i)/e>1}},c=t=>Math.floor(Math.random()*t),d=(t=32,i="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${i}`,f=(t,i)=>Math.random()*(i-t)+t,m=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,p=t=>t[c(t.length)];var w,v,u,y,g,M,x,k,b,S,T,W,E,P,I,O,R,j,A=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};const z=["#634e34","#2e536f","#1c7847"],C=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"],L=.4;class X{constructor(t=2){w.add(this),this.init=t=>{const{position:i,colors:e}=t;this.position=i,this.move={position:{x:200,y:200,z:0},direction:{x:1,y:1,z:1}},this.colors=e,this.intervals=[f(1e3,3e3),f(3e3,6e3),f(6e3,8e3),1e4],this.randomX=f(-1,L),this.randomY=f(-1,L),setInterval((()=>{this.randomX=f(-1,L),this.randomY=f(-1,L),this.intervals=[f(1e3,3e3),f(3e3,6e3),f(6e3,8e3),1e4]}),1e4),setInterval((()=>{f(-1,1)>0&&A(this,w,"m",j).call(this),f(-1,1)>0&&A(this,w,"m",R).call(this)}),8e3)},this.update=t=>{if(this.draw(t),t%1e4<this.intervals[0])A(this,v,"f").call(this);else if(t%1e4<this.intervals[1])A(this,u,"f").call(this);else if(t%1e4<this.intervals[2]){const i=this.intervals[1]+1e4*Math.floor(t/1e4),e=this.intervals[2]-this.intervals[1];A(this,g,"f").call(this,l({time:t,start:i,duration:e}).progress)}else if(t%1e4<this.intervals[3]){const i=this.intervals[2]+1e4*Math.floor(t/1e4),e=this.intervals[3]-this.intervals[2];A(this,M,"f").call(this,l({time:t,start:i,duration:e}).progress)}},v.set(this,(()=>{this.isMoving=!0,A(this,w,"m",I).call(this,this.defaultSpeed*(1+this.randomX)),A(this,w,"m",P).call(this,this.defaultSpeed*(1+this.randomY)),A(this,w,"m",O).call(this)})),u.set(this,(()=>{this.isMoving=!0,A(this,w,"m",I).call(this,this.defaultSpeed),A(this,w,"m",P).call(this,.2*this.defaultSpeed),A(this,w,"m",O).call(this)})),y.set(this,(()=>{this.isMoving=!0,A(this,w,"m",I).call(this,this.defaultSpeed),A(this,w,"m",P).call(this,1.2*this.defaultSpeed),A(this,w,"m",O).call(this)})),g.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;A(this,w,"m",I).call(this,this.defaultSpeed*(1-t)),A(this,w,"m",P).call(this,this.defaultSpeed*(1-t)),A(this,w,"m",O).call(this)})),M.set(this,(t=>{this.isMoving=!0,A(this,w,"m",I).call(this,this.defaultSpeed*t),A(this,w,"m",P).call(this,this.defaultSpeed*t),A(this,w,"m",O).call(this)})),this.remove=()=>{},this.draw=t=>{const e=i.get("layer1"),s=n(e),a=i.get("layer2"),o=n(a);s(((i,e)=>{this.isMoving?A(this,w,"m",k).call(this,i,e,t,this.position,.6+this.position.z/e.height*.4):A(this,w,"m",x).call(this,i,e,t,this.position,.6+this.position.z/e.height*.4)})),o(((i,e)=>{this.isMoving?A(this,w,"m",k).call(this,i,e,t,this.position,.3+this.position.z/e.height*.2):A(this,w,"m",x).call(this,i,e,t,this.position,.3+this.position.z/e.height*.2)}))},b.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(-12,-54,24,24),t.fillStyle=this.colors.eye,t.fillRect(-8,-46,4,4),t.fillRect(0,-46,4,4),t.fillStyle=this.colors.hair,t.fillRect(-16,-62,28,12),t.fillRect(8,-58,6,20)})),S.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(-12,38,8,8)})),T.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,-54,24,40)})),W.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,-54,24,12)})),E.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-14,23,12,8)})),this.defaultSpeed=t}}v=new WeakMap,u=new WeakMap,y=new WeakMap,g=new WeakMap,M=new WeakMap,b=new WeakMap,S=new WeakMap,T=new WeakMap,W=new WeakMap,E=new WeakMap,w=new WeakSet,x=function(t,i,e,s,n){t.setTransform(-n*this.move.direction.x,0,0,n,s.x-1*n,s.y+(26+Math.sin(e/128))*n),A(this,S,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(24+Math.sin(e/128))*n),A(this,T,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+62*n),A(this,W,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+73*n),A(this,E,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+14*n,s.y+73*n),A(this,E,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+20*n,s.y+(26+Math.sin(e/128))*n),A(this,S,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+2*Math.sin(e/128)*n),A(this,b,"f").call(this,t)},k=function(t,i,e,s,n){t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(4*Number(1===this.move.direction.x)-2)*n,s.y+(2*Math.sin(e/64)-28)*n),t.rotate(r(-8*Math.sin(e/128))),A(this,S,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(24+2*Math.sin(e/128))*n),A(this,T,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(63+2*Math.sin(e/128))*n),A(this,W,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+16*n),t.rotate(r(14*Math.sin(e/128)-2)),A(this,E,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(14+-28*Number(1===this.move.direction.x))*n,s.y+16*n),t.rotate(r(5+-14*Math.sin(e/128))),A(this,E,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+2*Math.sin(e/128)*n),A(this,b,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(18+-36*Number(1===this.move.direction.x))*n,s.y+(2*Math.sin(e/64)-28)*n),t.rotate(r(8*Math.sin(e/128))),A(this,S,"f").call(this,t)},P=function(t){this.position.y=this.position.y+t*this.move.direction.y,this.position.z=this.position.y},I=function(t){this.position.x=this.position.x+t*this.move.direction.x},O=function(){(this.position.x<-20||this.position.x>=document.body.clientWidth)&&A(this,w,"m",j).call(this),(this.position.y<-10||this.position.y>=document.body.clientHeight)&&A(this,w,"m",R).call(this)},R=function(){this.move.direction.y=-1*this.move.direction.y},j=function(){this.move.direction.x=-1*this.move.direction.x};class Y{constructor(){this.start=()=>{this.persons=[...new Array(100)].map((()=>new X)),this.persons.forEach((t=>{t.init({position:{x:c(this.layer1.width),y:c(this.layer1.height),z:0},colors:{hair:m(),eye:p(z),skin:p(C),top:m(),bottom:m(),shoe:m()}})})),this.magnifier.init({position:{x:0,y:0},range:50})},this.update=t=>{this.persons.forEach((i=>{i.update(t)})),this.magnifier.update(t)},this.end=()=>{this.persons.forEach((t=>t.remove()))},this.persons=[],this.layer1=i.get("layer1"),this.magnifier=new h}}const $=new Proxy({isSoundOn:!1},{set:(t,i,e)=>(Object.assign(t,{[i]:e}),Object.assign(q,Object.assign(Object.assign({},q),$)),!0)}),V=$,q=new Proxy(Object.assign({},V),{set:(t,i,e)=>(Object.assign(t,{[i]:e}),!0)});var N,F,H,B,D,U,G,J,K=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class Q{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>K(this,D,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=q;(t=>{Object.assign(V,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,K(this,N,"f").call(this)},this.update=t=>{K(this,U,"f").call(this),K(this,G,"f").call(this),K(this,J,"f").call(this,t)},this.end=()=>{K(this,F,"f").call(this)},N.set(this,(()=>{window.addEventListener("keydown",(t=>{K(this,H,"f").call(this,t),K(this,B,"f").call(this,t)}))})),F.set(this,(()=>{window.removeEventListener("keydown",K(this,H,"f")),window.removeEventListener("keydown",K(this,B,"f"))})),H.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),B.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),D.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),U.set(this,(()=>{const t=i.get("layer1");n(t)(((t,i)=>{t.setTransform(1,0,0,1,i.width/2-172,i.height/2-200),t.font=d(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),G.set(this,(()=>{const t=i.get("layer1");n(t)(((t,i)=>{t.setTransform(1,0,0,1,i.width/2-20,i.height/2-100),t.font=d(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=d(12);const e=q.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${e} ]`,0,0):t.fillText(`Sound ${e}`,0,0),t.setTransform(1,0,0,1,i.width/2-100,i.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),J.set(this,(t=>{const e=i.get("layer1");n(e)(((i,e)=>{i.setTransform(1,0,0,1,e.width/2-100,e.height/2+40+2*Math.sin(t/60)),i.font=d(12),i.fillText("Press spacebar to act",0,0)}))}))}}N=new WeakMap,F=new WeakMap,H=new WeakMap,B=new WeakMap,D=new WeakMap,U=new WeakMap,G=new WeakMap,J=new WeakMap;var Z,_,tt,it,et=function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};Z=new WeakMap,_=new WeakMap,tt=new WeakMap,it=new WeakMap,e("layer1"),e("layer2"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(et(this,tt,"f")),et(this,it,"f").call(this)},Z.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),_.set(this,(t=>{console.log("canvas click"),console.log(t)})),tt.set(this,(i=>{[...t.values()].map((t=>(t=>{const i=t.getContext("2d");return()=>{i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(i),requestAnimationFrame(et(this,tt,"f"))})),it.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:i,payload:e}=t.data;switch(i){case"change-scene":et(this,Z,"f").call(this,e);break;case"click-canvas":et(this,_,"f").call(this,e)}}))})),this.activeScene="title",this.scenes={play:new Y,title:new Q}}}).start()})();