(()=>{"use strict";const t=new Map,e=t;window.addEventListener("resize",(()=>{[...t.values()].map((t=>{s(t)})),(()=>{const t=document.querySelector('meta[name="viewport"]'),e=Math.round(visualViewport.scale*visualViewport.width),s=Math.round(visualViewport.scale*visualViewport.height);e<=460||s<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):e<=768||s<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()}));const s=t=>{t.width=window.innerWidth,t.height=window.innerHeight},i=t=>{const e=t.getContext("2d");return s=>{e.save(),e.beginPath(),s(e,t),e.closePath(),e.restore()}},a=t=>Math.PI/180*t,n=({time:t,start:e,duration:s})=>{const i=(t-e)/s<0?0:(t-e)/s;return{isProgressing:i<1&&i>0,progress:i,isReserved:(t-e)/s<0,isEnded:(t-e)/s>1}},h=t=>Math.floor(Math.random()*t),o=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`,r=(t,e)=>Math.random()*(e-t)+t,l=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,c=t=>t[h(t.length)];var d,f,m=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};class w{constructor(){this.init=({stage:t,timeout:e})=>{this.stage=t,this.timeout=e},this.remove=()=>{},this.update=t=>{this.startTime||(this.startTime=t),m(this,d,"f").call(this),m(this,f,"f").call(this,t)},d.set(this,(()=>{const t=e.get("layer1");i(t)((t=>{t.setTransform(1,0,0,1,0,0),t.font=o(24),t.fillText(`Stage ${this.stage}`,40,56)}))})),f.set(this,(t=>{const s=e.get("layer1");i(s)(((e,s)=>{const i=(Math.max(this.timeout-(t-this.startTime),0)/1e3).toFixed(2);e.setTransform(1,0,0,1,s.width,0),e.font=o(24),e.fillText(i+"",-120,56)}))}))}}d=new WeakMap,f=new WeakMap;var p,u,v,y,M,g,x,T,k,S,b,W,E,R,P,I,A,j,O=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};const C=["#634e34","#2e536f","#1c7847"],L=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"],$=.4;class z{constructor(t=2){p.add(this),this.init=t=>{const{position:e,colors:s}=t;this.position=e,this.move={position:{x:200,y:200,z:0},direction:{x:1,y:1,z:1}},this.colors=s,this.isEnlarged=!1,this.intervals=[r(1e3,3e3),r(3e3,6e3),r(6e3,8e3),1e4],this.randomX=r(-1,$),this.randomY=r(-1,$),setInterval((()=>{this.randomX=r(-1,$),this.randomY=r(-1,$),this.intervals=[r(1e3,3e3),r(3e3,6e3),r(6e3,8e3),1e4]}),1e4),setInterval((()=>{r(-1,1)>0&&O(this,p,"m",j).call(this),r(-1,1)>0&&O(this,p,"m",A).call(this)}),8e3)},this.update=t=>{if(this.draw(t),t%1e4<this.intervals[0])O(this,u,"f").call(this);else if(t%1e4<this.intervals[1])O(this,v,"f").call(this);else if(t%1e4<this.intervals[2]){const e=this.intervals[1]+1e4*Math.floor(t/1e4),s=this.intervals[2]-this.intervals[1];O(this,M,"f").call(this,n({time:t,start:e,duration:s}).progress)}else if(t%1e4<this.intervals[3]){const e=this.intervals[2]+1e4*Math.floor(t/1e4),s=this.intervals[3]-this.intervals[2];O(this,g,"f").call(this,n({time:t,start:e,duration:s}).progress)}},u.set(this,(()=>{this.isMoving=!0,O(this,p,"m",P).call(this,this.defaultSpeed*(1+this.randomX)),O(this,p,"m",R).call(this,this.defaultSpeed*(1+this.randomY)),O(this,p,"m",I).call(this)})),v.set(this,(()=>{this.isMoving=!0,O(this,p,"m",P).call(this,this.defaultSpeed),O(this,p,"m",R).call(this,.2*this.defaultSpeed),O(this,p,"m",I).call(this)})),y.set(this,(()=>{this.isMoving=!0,O(this,p,"m",P).call(this,this.defaultSpeed),O(this,p,"m",R).call(this,1.2*this.defaultSpeed),O(this,p,"m",I).call(this)})),M.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;O(this,p,"m",P).call(this,this.defaultSpeed*(1-t)),O(this,p,"m",R).call(this,this.defaultSpeed*(1-t)),O(this,p,"m",I).call(this)})),g.set(this,(t=>{this.isMoving=!0,O(this,p,"m",P).call(this,this.defaultSpeed*t),O(this,p,"m",R).call(this,this.defaultSpeed*t),O(this,p,"m",I).call(this)})),this.remove=()=>{},this.draw=t=>{const s=e.get("layer1");i(s)(((e,s)=>{this.isMoving?O(this,p,"m",T).call(this,e,s,t,this.position):O(this,p,"m",x).call(this,e,s,t,this.position)}))},k.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(0,0,24,24),t.fillStyle=this.colors.eye,t.fillRect(4,8,4,4),t.fillRect(12,8,4,4),t.fillStyle=this.colors.hair,t.fillRect(-4,-8,28,12),t.fillRect(20,-4,6,20)})),S.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(0,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(0,38,8,8)})),b.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(0,0,24,40)})),W.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(0,0,24,12)})),E.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(0,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-2,23,12,8)})),this.defaultSpeed=t}get sizeRatio(){return this.isEnlarged?1:.5}}u=new WeakMap,v=new WeakMap,y=new WeakMap,M=new WeakMap,g=new WeakMap,k=new WeakMap,S=new WeakMap,b=new WeakMap,W=new WeakMap,E=new WeakMap,p=new WeakSet,x=function(t,e,s,i){t.setTransform(1,0,0,1,i.x-4,i.y+26+1*Math.sin(s/128)),O(this,S,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+24+1*Math.sin(s/128)),O(this,b,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+62),O(this,W,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+73),O(this,E,"f").call(this,t),t.setTransform(1,0,0,1,i.x+14,i.y+73),O(this,E,"f").call(this,t),t.setTransform(1,0,0,1,i.x+20,i.y+26+1*Math.sin(s/128)),O(this,S,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+2*Math.sin(s/128)),O(this,k,"f").call(this,t)},T=function(t,e,s,i){t.setTransform(1,0,0,1,i.x+-2,i.y+26+2*Math.sin(s/64)),t.rotate(a(-8*Math.sin(s/128))),O(this,S,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+24+2*Math.sin(s/128)),O(this,b,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+63+2*Math.sin(s/128)),O(this,W,"f").call(this,t),t.setTransform(1,0,0,1.1,i.x,i.y+70),t.rotate(a(14*Math.sin(s/128)-2)),O(this,E,"f").call(this,t),t.setTransform(1,0,0,1.1,i.x+14,i.y+70),t.rotate(a(5+-14*Math.sin(s/128))),O(this,E,"f").call(this,t),t.setTransform(1,0,0,1,i.x,i.y+2*Math.sin(s/128)),O(this,k,"f").call(this,t),t.setTransform(1,0,0,1,i.x+18,i.y+26+2*Math.sin(s/64)),t.rotate(a(8*Math.sin(s/128))),O(this,S,"f").call(this,t)},R=function(t){this.position.y=this.position.y+t*this.move.direction.y},P=function(t){this.position.x=this.position.x+t*this.move.direction.x},I=function(){(this.position.x<-20||this.position.x>=document.body.clientWidth)&&O(this,p,"m",j).call(this),(this.position.y<-10||this.position.y>=document.body.clientHeight)&&O(this,p,"m",A).call(this)},A=function(){this.move.direction.y=-1*this.move.direction.y},j=function(){this.move.direction.x=-1*this.move.direction.x};class V{constructor(){this.stage=0,this.timeout=1e4,this.start=()=>{this.info.init({stage:this.stage,timeout:this.timeout}),this.persons=[...new Array(100)].map((()=>new z)),this.persons.forEach((t=>{t.init({position:{x:h(this.layer1.width),y:h(this.layer1.height),z:0},colors:{hair:l(),eye:c(C),skin:c(L),top:l(),bottom:l(),shoe:l()}})}))},this.update=t=>{this.info.update(t),this.persons.forEach((e=>e.update(t)))},this.end=()=>{this.info.remove(),this.persons.forEach((t=>t.remove()))},this.info=new w,this.persons=[],this.layer1=e.get("layer1")}}const X=new Proxy({isSoundOn:!1},{set:(t,e,s)=>(Object.assign(t,{[e]:s}),Object.assign(q,{...q,...X}),!0)}),Y=X,q=new Proxy({...Y},{set:(t,e,s)=>(Object.assign(t,{[e]:s}),!0)});var F,H,B,D,U,G,J,K,N=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};class Q{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>N(this,U,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=q;(t=>{Object.assign(Y,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,N(this,F,"f").call(this)},this.update=t=>{N(this,G,"f").call(this),N(this,J,"f").call(this),N(this,K,"f").call(this,t)},this.end=()=>{N(this,H,"f").call(this)},F.set(this,(()=>{window.addEventListener("keydown",(t=>{N(this,B,"f").call(this,t),N(this,D,"f").call(this,t)}))})),H.set(this,(()=>{window.removeEventListener("keydown",N(this,B,"f")),window.removeEventListener("keydown",N(this,D,"f"))})),B.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),D.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),U.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),G.set(this,(()=>{const t=e.get("layer1");i(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=o(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),J.set(this,(()=>{const t=e.get("layer1");i(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-20,e.height/2-100),t.font=o(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=o(12);const s=q.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${s} ]`,0,0):t.fillText(`Sound ${s}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),K.set(this,(t=>{const s=e.get("layer1");i(s)(((e,s)=>{e.setTransform(1,0,0,1,s.width/2-100,s.height/2+40+2*Math.sin(t/60)),e.font=o(12),e.fillText("Press spacebar to act",0,0)}))}))}}F=new WeakMap,H=new WeakMap,B=new WeakMap,D=new WeakMap,U=new WeakMap,G=new WeakMap,J=new WeakMap,K=new WeakMap;var Z,_,tt,et,st=function(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)};Z=new WeakMap,_=new WeakMap,tt=new WeakMap,et=new WeakMap,(e=>{if(t.has(e))return t.get(e);const i=Object.assign(document.createElement("canvas"),{id:e});t.set(e,i),document.body.appendChild(i),s(i),i.addEventListener("click",(t=>{window.postMessage({type:"click-canvas",payload:{id:e,x:t.clientX,y:t.clientY}},window.origin)}))})("layer1"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(st(this,tt,"f")),st(this,et,"f").call(this)},Z.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),_.set(this,(t=>{console.log("canvas click"),console.log(t)})),tt.set(this,(e=>{[...t.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(e),requestAnimationFrame(st(this,tt,"f"))})),et.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:e,payload:s}=t.data;switch(e){case"change-scene":st(this,Z,"f").call(this,s);break;case"click-canvas":st(this,_,"f").call(this,s)}}))})),this.activeScene="title",this.scenes={play:new V,title:new Q}}}).start()})();