(()=>{"use strict";const t=new Map,e=t;window.addEventListener("resize",(()=>{[...t.values()].map((t=>{s(t)})),(()=>{const t=document.querySelector('meta[name="viewport"]'),e=Math.round(visualViewport.scale*visualViewport.width),i=Math.round(visualViewport.scale*visualViewport.height);e<=460||i<=460?t.setAttribute("content","width=device-width, initial-scale=0.5, user-scalable=0"):e<=768||i<=768?t.setAttribute("content","width=device-width, initial-scale=0.725, user-scalable=0"):t.setAttribute("content","width=device-width, initial-scale=1.0, user-scalable=0")})()}));const i=e=>{if(t.has(e))return t.get(e);const i=Object.assign(document.createElement("canvas"),{id:e});return t.set(e,i),document.body.appendChild(i),s(i),i.addEventListener("click",(t=>{window.postMessage({type:"click-canvas",payload:{id:e,x:t.clientX,y:t.clientY}},window.origin)})),i},s=t=>{t.width=window.innerWidth,t.height=window.innerHeight},n=t=>{const e=t.getContext("2d");return i=>{e.save(),e.beginPath(),i(e,t),e.closePath(),e.restore()}},a=t=>Math.PI/180*t,h=({time:t,start:e,duration:i})=>{const s=(t-e)/i<0?0:(t-e)/i;return{isProgressing:s<1&&s>0,progress:s,isReserved:(t-e)/i<0,isEnded:(t-e)/i>1}},o=t=>Math.floor(Math.random()*t),r=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`,l=(t,e)=>Math.random()*(e-t)+t,c=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,d=t=>t[o(t.length)];var f,m,w=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class p{constructor(){this.init=({stage:t,timeout:e})=>{this.stage=t,this.timeout=e},this.remove=()=>{},this.update=t=>{this.startTime||(this.startTime=t),w(this,f,"f").call(this),w(this,m,"f").call(this,t)},f.set(this,(()=>{const t=e.get("layer3");n(t)((t=>{t.setTransform(1,0,0,1,0,0),t.font=r(24),t.fillText(`Stage ${this.stage}`,40,56)}))})),m.set(this,(t=>{const i=e.get("layer3");n(i)(((e,i)=>{const s=(Math.max(this.timeout-(t-this.startTime),0)/1e3).toFixed(2);e.setTransform(1,0,0,1,i.width,0),e.font=r(24),e.fillText(s+"",-120,56)}))}))}}f=new WeakMap,m=new WeakMap;var u,v=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class y{constructor(){this.init=({position:t,range:e})=>{this.position=t,this.range=e,window.addEventListener("mousemove",v(this,u,"f"))},this.update=t=>{const e=n(this.layer1),i=n(this.layer2),s=n(this.layer3);e(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-in",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),i(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-out",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),s(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.lineWidth=2,t.strokeStyle="#000",t.beginPath(),t.arc(0,0,this.range,0,2*Math.PI,!0),t.stroke()}))},this.remove=()=>{window.removeEventListener("mousemove",v(this,u,"f"))},u.set(this,(t=>{this.position={x:t.clientX,y:t.clientY}})),this.layer1=e.get("layer1"),this.layer2=e.get("layer2"),this.layer3=e.get("layer3")}}u=new WeakMap;var g,M,x,T,k,S,b,W,I,E,P,A,R,j,C,L,O,$,z,N,X=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};const V=["#634e34","#2e536f","#1c7847"],Y=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"];class q{constructor(t=.4){g.add(this),this.init=t=>{const{id:e,position:i,colors:s}=t;this.id=e,this.position=i,this.move={direction:{x:Math.round(Math.random())?1:-1,y:Math.round(Math.random())?1:-1,z:1}},this.colors=s;const n=[...Array.from({length:12},(()=>X(this,M,"f"))),...Array.from({length:4},(()=>X(this,x,"f"))),...Array.from({length:24},(()=>X(this,k,"f"))),...Array.from({length:8},(()=>X(this,b,"f"))),...Array.from({length:2},(()=>X(this,I,"f"))),X(this,S,"f"),X(this,T,"f"),X(this,W,"f"),X(this,E,"f")],a=()=>Math.floor(l(0,n.length-1)),h=()=>{this.moves=[n[a()],n[a()]]},o=()=>{this.intervals=[l(4e3,7e3)]},r=()=>{this.randomX=l(-1,.3),this.randomY=l(-1,.3)},c=()=>{l(-1,1)>0&&X(this,g,"m",N).call(this),l(-1,1)>0&&X(this,g,"m",z).call(this)};h(),o(),r(),setInterval((()=>{r(),o(),h()}),l(8e3,16e3)),setInterval((()=>{c()}),l(8e3,16e3))},this.update=t=>{if(this.draw(t),t%1e4<this.intervals[0]){const e=0+1e4*Math.floor(t/1e4),i=this.intervals[0];return void this.moves[0](h({time:t,start:e,duration:i}).progress)}const e=this.intervals[0]+1e4*Math.floor(t/1e4),i=1e4-this.intervals[0];this.moves[1](h({time:t,start:e,duration:i}).progress)},M.set(this,(()=>{this.isMoving=!1})),x.set(this,(()=>{this.isMoving=!0,X(this,g,"m",O).call(this,this.defaultSpeed*(1+this.randomX)),X(this,g,"m",$).call(this)})),T.set(this,(()=>{this.isMoving=!0,X(this,g,"m",O).call(this,this.defaultSpeed*(1+this.randomX)),X(this,g,"m",L).call(this,this.defaultSpeed*(1+this.randomY)*.6),X(this,g,"m",$).call(this)})),k.set(this,(()=>{this.isMoving=!0,X(this,g,"m",O).call(this,this.defaultSpeed),X(this,g,"m",L).call(this,.2*this.defaultSpeed),X(this,g,"m",$).call(this)})),S.set(this,(()=>{this.isMoving=!0,X(this,g,"m",O).call(this,this.defaultSpeed),X(this,g,"m",L).call(this,1.2*this.defaultSpeed),X(this,g,"m",$).call(this)})),b.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;X(this,g,"m",O).call(this,this.defaultSpeed*(1-t)),X(this,g,"m",L).call(this,.2*this.defaultSpeed*(1-t)),X(this,g,"m",$).call(this)})),W.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;const e=Math.max(.8,t);X(this,g,"m",O).call(this,this.defaultSpeed*(1-e)),X(this,g,"m",L).call(this,this.defaultSpeed*(1-e)),X(this,g,"m",$).call(this)})),I.set(this,(t=>{this.isMoving=!0,X(this,g,"m",O).call(this,this.defaultSpeed*(1+t)),X(this,g,"m",L).call(this,this.defaultSpeed*(1+t)*.2),X(this,g,"m",$).call(this)})),E.set(this,(t=>{this.isMoving=!0;const e=Math.max(Math.min(.2,t),1);X(this,g,"m",O).call(this,this.defaultSpeed*(1+e)),X(this,g,"m",L).call(this,this.defaultSpeed*(1+e)*.6),X(this,g,"m",$).call(this)})),this.remove=()=>{},this.draw=t=>{const i=e.get("layer1"),s=n(i),a=e.get("layer2"),h=n(a);s(((e,i)=>{this.isMoving?this.drawMovement(e,i,t,this.position,.6+this.position.z/i.height*.4):this.drawIdle(e,i,t,this.position,.6+this.position.z/i.height*.4)})),h(((e,i)=>{this.isMoving?this.drawMovement(e,i,t,this.position,.3+this.position.z/i.height*.2):this.drawIdle(e,i,t,this.position,.3+this.position.z/i.height*.2)}))},P.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(-12,-54,24,24),t.fillStyle=this.colors.eye,t.fillRect(-8,-46,4,4),t.fillRect(0,-46,4,4),t.fillStyle=this.colors.hair,t.fillRect(-16,-62,28,12),t.fillRect(8,-58,6,20)})),A.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(-12,38,8,8)})),R.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,-54,24,40)})),j.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,-54,24,12)})),C.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-14,23,12,8)})),this.defaultSpeed=t}drawIdle(t,e,i,s,n){t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(4*Number(1===this.move.direction.x)-2)*n,s.y+(-28+Math.sin(i/128))*n),X(this,A,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(24+Math.sin(i/128))*n),X(this,R,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(63+Math.sin(i/128))*n),X(this,j,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+16*n),X(this,C,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(14+-28*Number(1===this.move.direction.x))*n,s.y+16*n),X(this,C,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+Math.sin(i/128)*n),X(this,P,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(18+-36*Number(1===this.move.direction.x))*n,s.y+(-28+Math.sin(i/128))*n),X(this,A,"f").call(this,t)}drawMovement(t,e,i,s,n){t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(4*Number(1===this.move.direction.x)-2)*n,s.y+(2*Math.sin(i/64)-28)*n),t.rotate(a(-8*Math.sin(i/128))),X(this,A,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(24+2*Math.sin(i/128))*n),X(this,R,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+(63+2*Math.sin(i/128))*n),X(this,j,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+16*n),t.rotate(a(14*Math.sin(i/128)-2)),X(this,C,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(14+-28*Number(1===this.move.direction.x))*n,s.y+16*n),t.rotate(a(5+-14*Math.sin(i/128))),X(this,C,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x,s.y+2*Math.sin(i/128)*n),X(this,P,"f").call(this,t),t.setTransform(-n*this.move.direction.x,0,0,n,s.x+(18+-36*Number(1===this.move.direction.x))*n,s.y+(2*Math.sin(i/64)-28)*n),t.rotate(a(8*Math.sin(i/128))),X(this,A,"f").call(this,t)}}M=new WeakMap,x=new WeakMap,T=new WeakMap,k=new WeakMap,S=new WeakMap,b=new WeakMap,W=new WeakMap,I=new WeakMap,E=new WeakMap,P=new WeakMap,A=new WeakMap,R=new WeakMap,j=new WeakMap,C=new WeakMap,g=new WeakSet,L=function(t){this.position.y=this.position.y+t*this.move.direction.y},O=function(t){this.position.x=this.position.x+t*this.move.direction.x},$=function(){(this.position.x<-20||this.position.x>=document.body.clientWidth)&&X(this,g,"m",N).call(this),(this.position.y<-10||this.position.y>=document.body.clientHeight)&&X(this,g,"m",z).call(this)},z=function(){this.move.direction.y=-1*this.move.direction.y},N=function(){this.move.direction.x=-1*this.move.direction.x};var F,H,K,B,D,U=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class G{constructor(){this.init=t=>{const{persons:e}=t;this.persons=e,this.selectedIndex=0,window.addEventListener("keydown",U(this,D,"f"))},this.update=t=>{this.draw(t)},this.remove=()=>{window.removeEventListener("keydown",U(this,D,"f"))},this.draw=t=>{const i=e.get("layer3");n(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width-120,i.height-170),U(this,F,"f").call(this,e),this.persons[this.selectedIndex].isMoving?this.persons[this.selectedIndex].drawMovement(e,i,t,{x:i.width-70,y:i.height-85},1):this.persons[this.selectedIndex].drawIdle(e,i,t,{x:i.width-70,y:i.height-85},1),e.setTransform(1,0,0,1,i.width-26,i.height-110),U(this,H,"f").call(this,e),e.setTransform(1,0,0,1,i.width-113,i.height-110),U(this,K,"f").call(this,e),e.setTransform(1,0,0,1,i.width-74,i.height-180),U(this,B,"f").call(this,e)}))},F.set(this,(t=>{t.strokeStyle="#000",t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.8)",t.strokeRect(0,0,100,150),t.fillRect(0,0,100,150)})),H.set(this,(t=>{t.fillStyle="#000",t.beginPath(),t.moveTo(0,0),t.lineTo(15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=r(8),t.fillStyle="#fff",t.fillText("S",1,18)})),K.set(this,(t=>{t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.moveTo(0,0),t.lineTo(-15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=r(8),t.fillStyle="#fff",t.fillText("A",-10,18)})),B.set(this,(t=>{t.font=r(16),t.textAlign="center",t.fillStyle="#000",t.fillText(`${this.selectedIndex+1} / ${this.persons.length}`,0,0,100)})),D.set(this,(t=>{"KeyA"===t.code&&(0===this.selectedIndex?this.selectedIndex=this.persons.length-1:this.selectedIndex-=1),"KeyS"===t.code&&(this.selectedIndex===this.persons.length-1?this.selectedIndex=0:this.selectedIndex+=1)}))}}F=new WeakMap,H=new WeakMap,K=new WeakMap,B=new WeakMap,D=new WeakMap;class J{constructor(){this.stage=0,this.timeout=1e4,this.start=()=>{this.info.init({stage:this.stage,timeout:this.timeout}),this.persons=[...new Array(100)].map((()=>new q)),this.persons.forEach(((t,e)=>{t.init({id:e,position:{x:o(this.layer1.width),y:o(this.layer1.height),z:0},colors:{hair:c(),eye:d(V),skin:d(Y),top:c(),bottom:c(),shoe:c()}})})),this.magnifier.init({position:{x:0,y:0},range:100}),this.wantedPoster.init({persons:[this.persons[0],this.persons[1],this.persons[2]]})},this.update=t=>{this.info.update(t),this.persons.forEach((e=>{e.update(t)})),this.magnifier.update(t),this.wantedPoster.update(t)},this.end=()=>{this.info.remove(),this.persons.forEach((t=>t.remove()))},this.info=new p,this.persons=[],this.layer1=e.get("layer1"),this.magnifier=new y,this.wantedPoster=new G}}const Q=new Proxy({isSoundOn:!1},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),Object.assign(_,{..._,...Q}),!0)}),Z=Q,_=new Proxy({...Z},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),!0)});var tt,et,it,st,nt,at,ht,ot,rt=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class lt{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>rt(this,nt,"f").call(this,"play")},{key:"sound",action:()=>{const{isSoundOn:t}=_;(t=>{Object.assign(Z,{isSoundOn:t})})(!t)}}],this.start=()=>{this.activeMenuIndex=0,rt(this,tt,"f").call(this)},this.update=t=>{rt(this,at,"f").call(this),rt(this,ht,"f").call(this),rt(this,ot,"f").call(this,t)},this.end=()=>{rt(this,et,"f").call(this)},tt.set(this,(()=>{window.addEventListener("keydown",rt(this,it,"f")),window.addEventListener("keydown",rt(this,st,"f"))})),et.set(this,(()=>{window.removeEventListener("keydown",rt(this,it,"f")),window.removeEventListener("keydown",rt(this,st,"f"))})),it.set(this,(t=>{"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),st.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),nt.set(this,(t=>{window.postMessage({type:"change-scene",payload:t},window.origin)})),at.set(this,(()=>{const t=e.get("layer1");n(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=r(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),ht.set(this,(()=>{const t=e.get("layer1");n(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-20,e.height/2-100),t.font=r(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=r(12);const i=_.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${i} ]`,0,0):t.fillText(`Sound ${i}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),ot.set(this,(t=>{const i=e.get("layer1");n(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width/2-100,i.height/2+40+2*Math.sin(t/60)),e.font=r(12),e.fillText("Press spacebar to act",0,0)}))}))}}tt=new WeakMap,et=new WeakMap,it=new WeakMap,st=new WeakMap,nt=new WeakMap,at=new WeakMap,ht=new WeakMap,ot=new WeakMap;var ct,dt,ft,mt,wt=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};ct=new WeakMap,dt=new WeakMap,ft=new WeakMap,mt=new WeakMap,i("layer1"),i("layer2"),i("layer3"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(wt(this,ft,"f")),wt(this,mt,"f").call(this)},ct.set(this,(t=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start()})),dt.set(this,(t=>{console.log("canvas click"),console.log(t)})),ft.set(this,(e=>{[...t.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(e),requestAnimationFrame(wt(this,ft,"f"))})),mt.set(this,(()=>{window.addEventListener("message",(t=>{if(!t.data)return;const{type:e,payload:i}=t.data;switch(e){case"change-scene":wt(this,ct,"f").call(this,i);break;case"click-canvas":wt(this,dt,"f").call(this,i)}}))})),this.activeScene="title",this.scenes={play:new J,title:new lt}}}).start()})();