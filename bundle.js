(()=>{"use strict";const t=new Map,e=t;window.addEventListener("resize",(()=>{[...t.values()].map((t=>{s(t)}))}));const i=e=>{if(t.has(e))return t.get(e);const i=Object.assign(document.createElement("canvas"),{id:e});return t.set(e,i),document.body.appendChild(i),s(i),i.addEventListener("click",(t=>{window.postMessage({type:"click-canvas",payload:{id:e,x:t.clientX,y:t.clientY}},window.origin)})),i},s=t=>{t.width=Math.min(window.innerWidth,window.innerHeight),t.height=Math.min(window.innerWidth,window.innerHeight)},o=t=>{const e=t.getContext("2d");return i=>{e.save(),e.beginPath(),i(e,t),e.closePath(),e.restore()}},h=({type:t,payload:e})=>{window.postMessage({type:t,payload:e},window.origin)},n=(t,e,i=0)=>{t.beginPath();const s=t.createLinearGradient(0,0,0,300);s.addColorStop(0,"#afe8f8"),s.addColorStop(.4,"#fff"),s.addColorStop(.5,"#fff"),s.addColorStop(1,"#cff7fd"),t.filter=`hue-rotate(${i}deg)`,t.fillStyle=s,t.fillRect(0,0,e.width,160),t.filter="none",t.closePath()};var r,a,l,c=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class f{constructor(){r.set(this,o(e.get("bg"))),this.init=()=>{},this.update=t=>{c(this,r,"f").call(this,((t,e)=>{t.setTransform(1,0,0,1,0,0),n(t,e),t.transform(1,0,0,1,0,160),c(this,a,"f").call(this,t,e),t.setTransform(1,0,0,1,0,240),c(this,l,"f").call(this,t,e),t.transform(1,0,0,1,0,10);const i=(e.height-480)/2;t.fillStyle="#0abb7d",t.fillRect(0,0,e.width,i),t.transform(1,0,0,1,0,i),t.fillStyle="#0cae75",t.fillRect(0,0,e.width,i)}))},this.remove=()=>{c(this,r,"f").call(this,((t,e)=>{t.clearRect(0,0,e.width,e.height)}))},a.set(this,((t,e)=>{t.fillStyle="#f6fae6",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#e5fab3",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#d8fbb3",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#c0fb8e",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#c0fb8e",t.fillRect(0,0,e.width,20)})),l.set(this,((t,e)=>{t.beginPath(),t.fillStyle="#c04942",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,e.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,e.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,e.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,e.width,8),t.transform(1,0,0,1,0,8),t.fillStyle="#c04942",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#dc5349",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#fff",t.fillRect(0,0,e.width,8)}))}}r=new WeakMap,a=new WeakMap,l=new WeakMap;var d,m,w,p=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class u{constructor(){d.set(this,o(e.get("bg"))),this.init=()=>{},this.update=t=>{p(this,d,"f").call(this,((t,e)=>{t.setTransform(1,0,0,1,0,0),n(t,e),t.transform(1,0,0,1,0,160),p(this,m,"f").call(this,t,e);const i=(e.height-340)/4;p(this,w,"f").call(this,t,e,i)}))},this.remove=()=>{p(this,d,"f").call(this,((t,e)=>{t.clearRect(0,0,e.width,e.height)}))},m.set(this,((t,e)=>{t.fillStyle="#cff7fd",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#86f2f9",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#50effa",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#78ebfa",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#8ceffa",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#9ef8ff",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.globalAlpha=.8,t.fillStyle="#b4f9ff",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.fillStyle="#d5f9f9",t.fillRect(0,0,e.width,20),t.transform(1,0,0,1,0,20),t.globalAlpha=.6,t.fillStyle="#dbfdfb",t.fillRect(0,0,e.width,20)})),w.set(this,((t,e,i)=>{t.fillStyle="#fffbf0",t.fillRect(0,0,e.width,i),t.transform(1,0,0,1,0,i),t.fillStyle="#f2efe7",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#f7f4ec",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#f2eee4",t.fillRect(0,0,e.width,i),t.transform(1,0,0,1,0,i),t.fillStyle="#eae8e3",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#ece8de",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#e1ded2",t.fillRect(0,0,e.width,i),t.transform(1,0,0,1,0,i),t.fillStyle="#d2cec5",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#eaede8",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10);const s=t.createLinearGradient(0,0,0,i);s.addColorStop(0,"#fcfff9"),s.addColorStop(1,"#ece8de"),t.fillStyle=s,t.fillRect(0,0,e.width,i)}))}}d=new WeakMap,m=new WeakMap,w=new WeakMap;const y=t=>Math.PI/180*t,g=({time:t,start:e,duration:i})=>{const s=(t-e)/i<0?0:(t-e)/i;return{isProgressing:s<1&&s>0,progress:s,isReserved:(t-e)/i<0,isEnded:(t-e)/i>1}},v=(t=32,e="Arial Black, Arial, sans-serif")=>`bold ${t}pt ${e}`,x=(t,e)=>Math.round(Math.random()*(e-t)+t),M=()=>`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`,b=t=>{var e;return t[(e=t.length,Math.floor(Math.random()*e))]},S=(t,e)=>`#${(parseInt(t.replace("#","0x"))+e).toString(16)}`,k=(t,e)=>{const{left:i,right:s,top:o,bottom:h}=e,{x:n,y:r}=t;return i<=n&&n<=s&&o<=r&&r<=h},T={width:640,height:380},R={width:800,height:600},W=t=>t.width>R.width?R:T;var P,C=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class E{constructor(){P.set(this,o(e.get("bg"))),this.init=()=>{},this.update=t=>{C(this,P,"f").call(this,((t,e)=>{t.setTransform(1,0,0,1,0,0),n(t,e),t.transform(1,0,0,1,0,160);const i=Math.floor((e.height-160)/40/2)+2;for(let s=0;s<i;s++)t.fillStyle=S("#cccccc",197379*s),t.fillRect(0,0,e.width,40),t.transform(1,0,0,1,0,40);t.fillStyle="#d0d0d0",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#bdbdbd",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#7e7e7e",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10),t.fillStyle="#6f6f6f",t.fillRect(0,0,e.width,10),t.transform(1,0,0,1,0,10);for(let s=i;s<2*i+2;s++)t.fillStyle=S("#939393",197379*(i-s)),t.fillRect(0,0,e.width,40),t.transform(1,0,0,1,0,40);t.setTransform(1,0,0,1,0,160),t.fillStyle="#edda92",t.fillRect(0,40*(i-4),e.width,38),t.transform(1,0,0,1,0,40*(i-4)+38),t.fillStyle="#decc88",t.fillRect(0,0,e.width,2),t.setTransform(1,0,0,1,0,160),t.fillStyle="#fff",t.fillRect(0,40*(i+2),e.width,10)}))},this.remove=()=>{C(this,P,"f").call(this,((t,e)=>{t.clearRect(0,0,e.width,e.height)}))}}}P=new WeakMap;var I,B,A,L=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class j{constructor(){this.init=({stage:t,timeout:e,lifeCount:i})=>{this.stage=t,this.timeout=e,this.lifeCount=i},this.remove=()=>{},this.update=t=>{this.startTime||(this.startTime=t),L(this,I,"f").call(this),L(this,B,"f").call(this,t),L(this,A,"f").call(this)},I.set(this,(()=>{o(this.layer)((t=>{t.setTransform(1,0,0,1,0,0),t.font=v(24),t.fillText(`Stage ${this.stage}`,40,56)}))})),B.set(this,(t=>{o(this.layer)(((e,i)=>{const s=(Math.max(this.timeout-(t-this.startTime),0)/1e3).toFixed(2);e.setTransform(1,0,0,1,i.width,0),e.font=v(24),e.fillText(s+"",-120,56)}))})),A.set(this,(()=>{const t=o(this.layer),e=Math.min(50,50);[...new Array(this.lifeCount)].forEach(((i,s)=>{t(((t,i)=>{t.strokeStyle="#000000",t.shadowOffsetX=4,t.shadowOffsetY=4,t.lineWidth=6,t.fillStyle="#FF0000",t.setTransform(1,0,0,1,40+80*s,i.height-100),t.moveTo(0,e/4),t.quadraticCurveTo(0,0,e/4,0),t.quadraticCurveTo(e/2,0,e/2,e/4),t.quadraticCurveTo(e/2,0,3*e/4,0),t.quadraticCurveTo(e,0,e,e/4),t.quadraticCurveTo(e,e/2,3*e/4,3*e/4),t.lineTo(e/2,e),t.lineTo(e/4,3*e/4),t.quadraticCurveTo(0,e/2,0,e/4),t.stroke(),t.fill()}))}))})),this.layer=e.get("layer3")}}I=new WeakMap,B=new WeakMap,A=new WeakMap;var O,$=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class N{constructor(){this.init=({position:t,range:e})=>{this.position=t,this.range=e,window.addEventListener("mousemove",$(this,O,"f"))},this.update=t=>{const e=o(this.layer1),i=o(this.layer2),s=o(this.layer3);e(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-in",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),i(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.strokeStyle="#000",t.beginPath(),t.globalCompositeOperation="destination-out",t.arc(0,0,this.range,0,2*Math.PI,!0),t.fill()})),s(((t,e)=>{t.setTransform(1,0,0,1,this.position.x,this.position.y),t.lineWidth=2,t.strokeStyle="#000",t.beginPath(),t.arc(0,0,this.range,0,2*Math.PI,!0),t.stroke()}))},this.remove=()=>{window.removeEventListener("mousemove",$(this,O,"f"))},O.set(this,(t=>{this.position={x:t.clientX,y:t.clientY}})),this.layer1=e.get("layer1"),this.layer2=e.get("layer2"),this.layer3=e.get("layer3")}}O=new WeakMap;class H{constructor({left:t,top:e,width:i,height:s}){this.left=t,this.top=e,this.width=i,this.height=s,this.right=t+i,this.bottom=e+s}isInside(t){const{left:e,right:i,top:s,bottom:o}=this,{x:h,y:n}=t;return e<=h&&h<=i&&s<=n&&n<=o}}var z,q,X,Y,F,G,D,K,U,J,Q,V,Z,_,tt,et,it,st,ot,ht,nt,rt,at,lt,ct,ft,dt,mt=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};const wt=["#634e34","#2e536f","#1c7847"],pt=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"];class ut{constructor(t=.4){z.add(this),this.isHit=!1,this.correctAt=0,this.deadAt=0,this.init=t=>{const{id:e,position:i,colors:s,barrier:o}=t;this.id=e,this.position=i,this.move={direction:{x:Math.round(Math.random())?1:-1,y:Math.round(Math.random())?1:-1,z:1}},this.colors=s,this.barrier=o;const h=[...Array.from({length:12},(()=>mt(this,q,"f"))),...Array.from({length:4},(()=>mt(this,X,"f"))),...Array.from({length:24},(()=>mt(this,F,"f"))),...Array.from({length:8},(()=>mt(this,D,"f"))),...Array.from({length:2},(()=>mt(this,U,"f"))),mt(this,G,"f"),mt(this,Y,"f"),mt(this,K,"f"),mt(this,J,"f")],n=()=>Math.floor(x(0,h.length-1)),r=()=>{this.moves=[h[n()],h[n()]]},a=()=>{this.intervals=[x(4e3,7e3)]},l=()=>{this.randomX=x(-1,.3),this.randomY=x(-1,.3)},c=()=>{x(-1,1)>0&&mt(this,z,"m",at).call(this),x(-1,1)>0&&mt(this,z,"m",rt).call(this)};r(),a(),l(),setInterval((()=>{l(),a(),r()}),x(8e3,16e3)),setInterval((()=>{c()}),x(8e3,16e3))},this.update=t=>{if(this.draw(t),t%1e4<this.intervals[0]){const e=0+1e4*Math.floor(t/1e4),i=this.intervals[0];return void this.moves[0](g({time:t,start:e,duration:i}).progress)}const e=this.intervals[0]+1e4*Math.floor(t/1e4),i=1e4-this.intervals[0];this.moves[1](g({time:t,start:e,duration:i}).progress)},q.set(this,(()=>{this.isMoving=!1})),X.set(this,(()=>{this.isMoving=!0,mt(this,z,"m",ht).call(this,this.defaultSpeed*(1+this.randomX)),mt(this,z,"m",nt).call(this)})),Y.set(this,(()=>{this.isMoving=!0,mt(this,z,"m",ht).call(this,this.defaultSpeed*(1+this.randomX)),mt(this,z,"m",ot).call(this,this.defaultSpeed*(1+this.randomY)*.6),mt(this,z,"m",nt).call(this)})),F.set(this,(()=>{this.isMoving=!0,mt(this,z,"m",ht).call(this,this.defaultSpeed),mt(this,z,"m",ot).call(this,.2*this.defaultSpeed),mt(this,z,"m",nt).call(this)})),G.set(this,(()=>{this.isMoving=!0,mt(this,z,"m",ht).call(this,this.defaultSpeed),mt(this,z,"m",ot).call(this,1.2*this.defaultSpeed),mt(this,z,"m",nt).call(this)})),D.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;mt(this,z,"m",ht).call(this,this.defaultSpeed*(1-t)),mt(this,z,"m",ot).call(this,.2*this.defaultSpeed*(1-t)),mt(this,z,"m",nt).call(this)})),K.set(this,(t=>{if(this.isMoving=!0,1===t)return this.isMoving=!1;const e=Math.max(.8,t);mt(this,z,"m",ht).call(this,this.defaultSpeed*(1-e)),mt(this,z,"m",ot).call(this,this.defaultSpeed*(1-e)),mt(this,z,"m",nt).call(this)})),U.set(this,(t=>{this.isMoving=!0,mt(this,z,"m",ht).call(this,this.defaultSpeed*(1+t)),mt(this,z,"m",ot).call(this,this.defaultSpeed*(1+t)*.2),mt(this,z,"m",nt).call(this)})),J.set(this,(t=>{this.isMoving=!0;const e=Math.max(Math.min(.2,t),1);mt(this,z,"m",ht).call(this,this.defaultSpeed*(1+e)),mt(this,z,"m",ot).call(this,this.defaultSpeed*(1+e)*.6),mt(this,z,"m",nt).call(this)})),this.remove=()=>{},this.setIsHit=t=>{const{left:e,right:i,top:s,bottom:o}=this.hitBoxPosition,{x:h,y:n}=t;this.isHit=e<=h&&h<=i&&s<=n&&n<=o},this.draw=t=>{const i=e.get("layer1"),s=o(i),h=e.get("layer2"),n=o(h);s(((e,i)=>{const{width:s,height:o}=W(i);this.barrier=new H({left:i.width/2-s/2,top:i.height/2-o/2,width:s,height:o}),mt(this,dt,"f").call(this,e);const h=.6+this.position.z/i.height*.4;mt(this,et,"f").call(this),mt(this,ft,"f").call(this,e,i,t,this.position,h),this.correctAt?mt(this,lt,"f").call(this,e,i,t,this.position,h):this.deadAt?mt(this,ct,"f").call(this,e,i,t,this.position,h):(this.isHit&&mt(this,it,"f").call(this,e,i,t,this.position,h),this.isMoving?this.drawMovement(e,i,t,this.position,h):this.drawIdle(e,i,t,this.position,h))})),n(((e,i)=>{const{width:s,height:o}=W(i);this.barrier=new H({left:i.width/2-s/2,top:i.height/2-o/2,width:s,height:o}),mt(this,dt,"f").call(this,e),this.position.x<=this.barrier.left&&(this.position.x=this.barrier.left+10,this.move.direction.x=1),this.position.x>=this.barrier.right&&(this.position.x=this.barrier.right-10,this.move.direction.x=-1),this.position.y<=this.barrier.top&&(this.position.y=this.barrier.top+10,this.move.direction.y=1),this.position.y>=this.barrier.bottom&&(this.position.y=this.barrier.bottom-10,this.move.direction.y=-1);const h=.3+this.position.z/i.height*.2;mt(this,ft,"f").call(this,e,i,t,this.position,h),this.correctAt||this.deadAt?mt(this,lt,"f").call(this,e,i,t,this.position,h):(mt(this,ft,"f").call(this,e,i,t,this.position,h),this.isHit&&mt(this,it,"f").call(this,e,i,t,this.position,h),this.isMoving?this.drawMovement(e,i,t,this.position,h):this.drawIdle(e,i,t,this.position,h))}))},Q.set(this,(t=>{t.fillStyle=this.colors.skin,t.fillRect(-12,-54,24,24),t.fillStyle=this.colors.eye,t.fillRect(-8,-46,4,4),t.fillRect(0,-46,4,4),t.fillStyle=this.colors.hair,t.fillRect(-16,-62,28,12),t.fillRect(8,-58,6,20)})),V.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,0,8,38),t.fillStyle=this.colors.skin,t.fillRect(-12,38,8,8)})),Z.set(this,(t=>{t.fillStyle=this.colors.top,t.fillRect(-12,-54,24,40)})),_.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,-54,24,12)})),tt.set(this,(t=>{t.fillStyle=this.colors.bottom,t.fillRect(-12,0,10,24),t.fillStyle=this.colors.shoe,t.fillRect(-14,23,12,8)})),et.set(this,(()=>{this.hitBoxPosition={left:this.position.x-13.5,width:27,right:this.position.x+13.5,top:this.position.y-35-3,height:70,bottom:this.position.y+35}})),it.set(this,((t,e,i,s,o)=>{t.setTransform(o,0,0,o,s.x,s.y+(2*Math.sin(i/128)-74)*o),t.strokeStyle="#b6d9e9",t.beginPath(),t.ellipse(0,0,12,5,Math.PI,0,2*Math.PI),t.lineWidth=3,t.stroke(),t.strokeStyle="#fff",t.beginPath(),t.ellipse(0,0,10,5,Math.PI,0,2*Math.PI),t.lineWidth=3,t.stroke()})),st.set(this,((t,{isRect:e})=>{if(t.fillStyle="#fff",e)return t.fillRect(this.hitBoxPosition.left,this.hitBoxPosition.top,this.hitBoxPosition.width,this.hitBoxPosition.height),void t.fill();t.ellipse(this.position.x,this.position.y-5,35,55,Math.PI,0,2*Math.PI),t.fill()})),lt.set(this,((t,e,i,s,o)=>{const{isProgressing:h,progress:n}=g({time:i,start:this.correctAt,duration:500});if(!h||n<0)return;const r=Math.cos((1-n)*Math.PI*(2/3));t.setTransform(o,0,0,o,s.x,s.y+-74*o),t.scale(2,1),t.arc(0,120,24*Math.sin(n*Math.PI),0,y(360)),t.fillStyle="#000",t.fill(),t.filter=`opacity(${100*(1-r)}%) hue-rotate(${180*r}deg)`,t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(80*r-28)*o),mt(this,V,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x,s.y+(24+28*r)*o),mt(this,Z,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x,s.y+(63+-11*r)*o),mt(this,_,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x,s.y+(16+36*r)*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+(16+36*r)*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x,s.y+52*r*o),mt(this,Q,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o*(1-r),s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(80*r-28)*o),mt(this,V,"f").call(this,t)})),ct.set(this,((t,e,i,s,o)=>{const{isProgressing:h,progress:n}=g({time:i,start:this.deadAt,duration:200});!h||n<0||(t.setTransform(o,0,0,o,s.x,s.y+-74*o),t.filter=`grayscale(${100*n}%) opacity(${100*(1-n)}%)`,t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(-28+Math.sin(i/128))*o),mt(this,V,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+Math.sin(i/128))*o),mt(this,Z,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+Math.sin(i/128))*o),mt(this,_,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+Math.sin(i/128)*o),mt(this,Q,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(-28+Math.sin(i/128))*o),mt(this,V,"f").call(this,t))})),ft.set(this,((t,e,i,s,o)=>{const h=g({time:i,start:this.deadAt,duration:200});h.isEnded&&this.deadAt||this.correctAt||(t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+44*o),t.scale(2,1),t.arc(0,0,18,0,y(360)),t.fillStyle=h.isProgressing?`rgba(0, 0, 0, ${.1*(1-h.progress)})`:"rgba(0, 0, 0, 0.1)",t.fill())})),dt.set(this,(t=>{t.resetTransform(),t.beginPath(),t.strokeRect(this.barrier.left,this.barrier.top,this.barrier.width,this.barrier.height),t.closePath()})),this.defaultSpeed=t}drawIdle(t,e,i,s,o){t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(-28+Math.sin(i/128))*o),mt(this,V,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+Math.sin(i/128))*o),mt(this,Z,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+Math.sin(i/128))*o),mt(this,_,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+Math.sin(i/128)*o),mt(this,Q,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(-28+Math.sin(i/128))*o),mt(this,V,"f").call(this,t)}drawMovement(t,e,i,s,o){t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(4*Number(1===this.move.direction.x)-2)*o,s.y+(2*Math.sin(i/64)-28)*o),t.rotate(y(-8*Math.sin(i/128))),mt(this,V,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(24+2*Math.sin(i/128))*o),mt(this,Z,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+(63+2*Math.sin(i/128))*o),mt(this,_,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+16*o),t.rotate(y(14*Math.sin(i/128)-2)),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(14+-28*Number(1===this.move.direction.x))*o,s.y+16*o),t.rotate(y(5+-14*Math.sin(i/128))),mt(this,tt,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x,s.y+2*Math.sin(i/128)*o),mt(this,Q,"f").call(this,t),t.setTransform(-o*this.move.direction.x,0,0,o,s.x+(18+-36*Number(1===this.move.direction.x))*o,s.y+(2*Math.sin(i/64)-28)*o),t.rotate(y(8*Math.sin(i/128))),mt(this,V,"f").call(this,t)}}q=new WeakMap,X=new WeakMap,Y=new WeakMap,F=new WeakMap,G=new WeakMap,D=new WeakMap,K=new WeakMap,U=new WeakMap,J=new WeakMap,Q=new WeakMap,V=new WeakMap,Z=new WeakMap,_=new WeakMap,tt=new WeakMap,et=new WeakMap,it=new WeakMap,st=new WeakMap,lt=new WeakMap,ct=new WeakMap,ft=new WeakMap,dt=new WeakMap,z=new WeakSet,ot=function(t){this.position.y=this.position.y+t*this.move.direction.y},ht=function(t){this.position.x=this.position.x+t*this.move.direction.x},nt=function(){(this.position.x<this.barrier.left||this.position.x>=this.barrier.right)&&mt(this,z,"m",at).call(this),(this.position.y<this.barrier.top||this.position.y>=this.barrier.bottom-18)&&mt(this,z,"m",rt).call(this)},rt=function(){this.move.direction.y=-1*this.move.direction.y},at=function(){this.move.direction.x=-1*this.move.direction.x};const yt=new Proxy({isSoundOn:!1},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),Object.assign(vt,{...vt,...yt}),!0)}),gt=yt,vt=new Proxy({...gt},{set:(t,e,i)=>(Object.assign(t,{[e]:i}),!0)}),xt=(...t)=>St(kt(...t)),Mt=44100,bt=new(window.AudioContext||webkitAudioContext),St=(...t)=>{let e=bt.createBuffer(t.length,t[0].length,Mt),i=bt.createBufferSource();return t.map(((t,i)=>e.getChannelData(i).set(t))),i.buffer=e,i.connect(bt.destination),i.start(),i},kt=(t=1,e=.05,i=220,s=0,o=0,h=.1,n=0,r=1,a=0,l=0,c=0,f=0,d=0,m=0,w=0,p=0,u=0,y=1,g=0,v=0)=>{let x,M,b=2*Math.PI,S=a*=500*b/Mt/Mt,k=i*=(1+2*e*Math.random()-e)*b/Mt,T=[],R=0,W=0,P=0,C=1,E=0,I=0,B=0;for(l*=500*b/Mt**3,w*=b/Mt,c*=b/Mt,f*=Mt,d=d*Mt|0,M=(s=s*Mt+9)+(g*=Mt)+(o*=Mt)+(h*=Mt)+(u*=Mt)|0;P<M;T[P++]=B)++I%(100*p|0)||(B=n?n>1?n>2?n>3?Math.sin((R%b)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/b%2+2)%2:1-4*Math.abs(Math.round(R/b)-R/b):Math.sin(R),B=(d?1-v+v*Math.sin(b*P/d):1)*(B>0?1:-1)*Math.abs(B)**r*t*.2*(P<s?P/s:P<s+g?1-(P-s)/g*(1-y):P<s+g+o?y:P<M-u?(M-P-u)/h*y:0),B=u?B/2+(u>P?0:(P<M-u?1:(M-P)/u)*T[P-u|0]/2):B),x=(i+=a+=l)*Math.cos(w*W++),R+=x-x*m*(1-1e9*(Math.sin(P)+1)%2),C&&++C>f&&(i+=c,k+=c,C=0),!d||++E%d||(i=k,a=S,C=C||1);return T},Tt=t=>{if(vt.isSoundOn)switch(t){case"pick":xt(...[.3,,1384,.02,.01,0,,1.36,8.5,,,,,,15,,,,.01]);break;case"correct":xt(...[.4,.01,496,.05,.21,.47,,1.42,,-4.7,146,.1,.15,,,,.12,.76,.11,.28]);break;case"wrong":xt(...[.4,,455,,.07,.07,,.09,,-.2,,,.04,.8,33,.4,.29,.85,.09])}};var Rt,Wt,Pt,Ct,Et,It,Bt,At=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class Lt{constructor(){this.init=t=>{const{persons:e}=t;this.persons=e,this.selectedIndex=0,window.addEventListener("keydown",At(this,Et,"f"))},this.update=t=>{this.draw(t)},this.remove=()=>{window.removeEventListener("keydown",At(this,Et,"f"))},this.draw=t=>{const i=e.get("layer3");o(i)(((e,i)=>{if(e.setTransform(1,0,0,1,i.width-120,i.height-170),At(this,Rt,"f").call(this,e),!this.persons.length)return;const s=this.persons[this.selectedIndex];s.isMoving?s.drawMovement(e,i,t,{x:i.width-70,y:i.height-85},1):s.drawIdle(e,i,t,{x:i.width-70,y:i.height-85},1),e.setTransform(1,0,0,1,i.width-26,i.height-110),At(this,Wt,"f").call(this,e),e.setTransform(1,0,0,1,i.width-113,i.height-110),At(this,Pt,"f").call(this,e),e.setTransform(1,0,0,1,i.width-74,i.height-180),At(this,Ct,"f").call(this,e)}))},Rt.set(this,(t=>{t.strokeStyle="#000",t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.8)",t.strokeRect(0,0,100,150),t.fillRect(0,0,100,150)})),Wt.set(this,(t=>{t.fillStyle="#000",t.beginPath(),t.moveTo(0,0),t.lineTo(15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=v(8),t.fillStyle="#fff",t.fillText("S",1,18)})),Pt.set(this,(t=>{t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.moveTo(0,0),t.lineTo(-15,15),t.lineTo(0,30),t.lineTo(0,0),t.fill(),t.font=v(8),t.fillStyle="#fff",t.fillText("A",-10,18)})),Ct.set(this,(t=>{t.font=v(16),t.textAlign="center",t.fillStyle="#000",t.fillText(`${this.selectedIndex+1} / ${this.persons.length}`,0,0,100)})),Et.set(this,(t=>{"KeyA"===t.code&&(Tt("pick"),At(this,It,"f").call(this)),"KeyS"===t.code&&(Tt("pick"),At(this,Bt,"f").call(this))})),It.set(this,(()=>{0===this.selectedIndex?this.selectedIndex=this.persons.length-1:this.selectedIndex-=1})),Bt.set(this,(()=>{this.selectedIndex===this.persons.length-1?this.selectedIndex=0:this.selectedIndex+=1})),this.removePerson=t=>{this.persons=this.persons.filter((e=>e.id!==t)),this.selectedIndex=0}}}Rt=new WeakMap,Wt=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,It=new WeakMap,Bt=new WeakMap;const jt=class{constructor(t){this.play=(t=!1)=>{vt.isSoundOn&&(this.player=St(...this.buffer),this.player.loop=t)},this.stop=()=>{this.player?.stop()},this.buffer=((t,e,i,s=125)=>{let o,h,n,r,a,l,c,f,d,m,w,p,u,y,g,v=0,x=[],M=[],b=[],S=0,k=0,T=1,R={},W=Mt/s*60>>2;for(;T;S++)x=[T=f=w=u=0],i.map(((s,w)=>{for(c=e[s][S]||[0,0,0],T|=!!e[s][S],g=u+(e[s][0].length-2-!f)*W,y=w==i.length-1,h=2,r=u;h<c.length+y;f=++h){for(a=c[h],d=h==c.length+y-1&&y||m!=(c[0]||0)|a|0,n=0;n<W&&f;n++>W-99&&d?p+=(p<1)/99:0)l=(1-p)*x[v++]/2||0,M[r]=(M[r]||0)-l*k+l,b[r]=(b[r++]||0)+l*k+l;a&&(p=a%1,k=c[1]||0,(a|=0)&&(x=R[[m=c[v=0]||0,a]]=R[[m,a]]||(o=[...t[m]],o[2]*=2**((a-12)/12),a>0?kt(...o):[])))}u=g}));return[M,b]})(...t)}},Ot=[[[.4,0,232,.01,.09,.15,,,,,,,154.87,,,,.26],[.1,0,900,.02,,.07,4,0,,,,,,4],[.2,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.3,0,42,,.08,.18,1]],[[[,-.5,12,,,,24,,,22,,,,,18,,22,,12,,,,24,,,22,,,,,25,,27,,12,,,,24,,,22,,,16,,15,,20,,12,,,,24,,,22,,20,,18,,16,,20],[1,-.3,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,29,32,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,,,29,32,29,32,29,32],[2,.3,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,13,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,13,,],[3,.5,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30,12,24,12,24,18,30,18,30,24,36,24,36,18,30,18,30]]],[0],62];var $t,Nt,Ht,zt=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class qt{constructor(){this.start=({activeBackground:t,stage:e,timeout:i,lifeCount:s,personCount:o,wantedPersonCount:h})=>{this.activeBackground=t,this.backgrounds[this.activeBackground].init(),this.music.play(!0),this.info.init({stage:e,timeout:i,lifeCount:s}),this.wantedPersonCount=h,this.persons=[...new Array(o)].map((()=>new ut)),this.persons.forEach(((t,e)=>{t.init({id:e,position:{x:x(this.barrier.left,this.barrier.right),y:x(this.barrier.top,this.barrier.bottom-18),z:0},colors:{hair:M(),eye:b(wt),skin:b(pt),top:M(),bottom:M(),shoe:M()},barrier:this.barrier})})),this.magnifier.init({position:{x:0,y:0},range:120});const n=this.persons.filter((t=>t.id<h));this.wantedPoster.init({persons:[...n]}),window.addEventListener("click",zt(this,Ht,"f"))},this.update=t=>{this.backgrounds[this.activeBackground].update(t),this.info.update(t),this.persons.forEach((e=>{e.update(t)})),this.magnifier.update(t),this.wantedPoster.update(t),zt(this,$t,"f").call(this)},this.end=()=>{this.backgrounds[this.activeBackground].remove(),this.music.stop(),this.info.remove(),this.persons.forEach((t=>t.remove())),window.removeEventListener("click",zt(this,Ht,"f"))},$t.set(this,(()=>{(!this.info.lifeCount||this.info.timeout<0)&&(this.music.stop(),h({type:"change-scene",payload:{type:"gameover",state:{stage:this.info.stage}}}))})),Nt.set(this,(t=>{t.resetTransform(),t.beginPath(),t.strokeRect(this.barrier.left,this.barrier.top,this.barrier.width,this.barrier.height),t.closePath()})),Ht.set(this,(t=>{let e=!1,i=!1;this.persons.forEach((s=>{s.isHit||(s.setIsHit({x:t.clientX,y:t.clientY}),s.isHit&&(e=!0,s.id<this.wantedPersonCount?(i=!0,this.wantedPoster.removePerson(s.id),s.correctAt=performance.now()):s.deadAt=performance.now()))})),e&&(i?Tt("correct"):(Tt("wrong"),this.info.lifeCount=Math.max(0,this.info.lifeCount-1)))})),this.activeBackground="road",this.backgrounds={playground:new f,pool:new u,road:new E},this.info=new j,this.magnifier=new N,this.persons=[],this.layer1=e.get("layer1"),this.wantedPoster=new Lt,this.music=new jt(Ot),this.barrier=new H({left:this.layer1.width/5,top:this.layer1.height/5,width:this.layer1.width/5*3,height:this.layer1.height/5*3})}}$t=new WeakMap,Nt=new WeakMap,Ht=new WeakMap;const Xt={1:{activeBackground:"road",stage:1,timeout:6e4,lifeCount:5,personCount:100,wantedPersonCount:3},2:{activeBackground:"playground",stage:2,timeout:7e4,lifeCount:4,personCount:150,wantedPersonCount:4},3:{activeBackground:"road",stage:3,timeout:8e4,lifeCount:3,personCount:200,wantedPersonCount:5}},Yt=[[[.2,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.4],[.2,0,640,.01,.12,.24,1,.8,-.1,,-10,.2,,.8,,,.08,.8],[.2,0,84,,,,,.7,,,,.5,,6.7,1,.05],[.3,0,219,,,,,1.1,,-.1,-50,-.05,-.01,1],[.2,0,22,,.08,.08,3,12,,,,,.02,,,,.01]],[[[1,-.3,10,,,,13,,10,,,,10,,13,,10,,,,10,,13,,10,,15,,10,,13,,10,,,,10,,13,,10,,,,10,,15,,10,,,,10,,13,,15,,17,,15,,13,,10,,],[2,-.5,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,5,,,,],[,.5,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,1,,],[3,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,20,20],[4,.4,22,,,,22,,20,22,,,,,22,,20,22,,,,,22,,25,22,,,,,22,,20,22,,,,,22,,20,22,,,,,22,,20,22,,,,,22,,25,29,,,,,32,,25,27]]],[0],100];var Ft,Gt,Dt,Kt,Ut,Jt,Qt,Vt,Zt,_t=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class te{constructor(){this.activeMenuIndex=0,this.menus=[{key:"start",action:()=>h({type:"change-scene",payload:{type:"play",state:Xt[1]}})},{key:"sound",action:()=>{const{isSoundOn:t}=vt;(t=>{Object.assign(gt,{isSoundOn:t})})(!t),vt.isSoundOn?this.music.play(!0):this.music.stop()}}],this.music=new jt(Yt),this.hitBoxes={start:{},sound:{}},this.start=()=>{this.activeMenuIndex=0,_t(this,Ft,"f").call(this),this.music.play(!0)},this.update=t=>{_t(this,Jt,"f").call(this),_t(this,Qt,"f").call(this),_t(this,Vt,"f").call(this,t)},this.end=()=>{_t(this,Gt,"f").call(this),this.music.stop()},Ft.set(this,(()=>{window.addEventListener("keydown",_t(this,Kt,"f")),window.addEventListener("keydown",_t(this,Ut,"f")),window.addEventListener("click",_t(this,Dt,"f"))})),Gt.set(this,(()=>{window.removeEventListener("keydown",_t(this,Kt,"f")),window.removeEventListener("keydown",_t(this,Ut,"f")),window.removeEventListener("click",_t(this,Dt,"f"))})),Dt.set(this,(t=>{const{clientX:e,clientY:i}=t;k({x:e,y:i},this.hitBoxes.start)&&(this.activeMenuIndex=0,this.menus[this.activeMenuIndex].action()),k({x:e,y:i},this.hitBoxes.sound)&&(this.activeMenuIndex=1,this.menus[this.activeMenuIndex].action())})),Kt.set(this,(t=>{Tt("pick"),"ArrowDown"===t.code&&(this.activeMenuIndex=Math.min(this.activeMenuIndex+1,this.menus.length-1)),"ArrowUp"===t.code&&(this.activeMenuIndex=Math.max(this.activeMenuIndex-1,0))})),Ut.set(this,(t=>{"Space"===t.code&&this.menus[this.activeMenuIndex].action()})),Jt.set(this,(()=>{const t=e.get("layer1");o(t)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2-172,e.height/2-200),t.font=v(40),t.lineWidth=2,t.strokeText("The Reaper",0,0)}))})),Qt.set(this,(()=>{const t=e.get("layer1");o(t)(((t,e)=>{const i={x:e.width/2-20,y:e.height/2-100},s=i.x+-20,o=i.y+40;this.hitBoxes.start={left:i.x-3,width:51,right:i.x-3+51,top:i.y-18+3,height:18,bottom:i.y-18+3+18},this.hitBoxes.sound={left:s-3,width:110,right:s-3+110,top:o-18+3,height:18,bottom:o-18+3+18},t.setTransform(1,0,0,1,i.x,i.y),t.font=v(12),t.fillText("Start",0,0),t.transform(1,0,0,1,-20,40),t.font=v(12);const h=vt.isSoundOn?"on":"off";1===this.activeMenuIndex?t.fillText(`Sound [ ${h} ]`,0,0):t.fillText(`Sound ${h}`,0,0),t.setTransform(1,0,0,1,e.width/2-100,e.height/2-116+40*this.activeMenuIndex),t.beginPath(),t.moveTo(0,0),t.lineTo(16,10),t.lineTo(0,20),t.lineWidth=1,t.closePath(),t.stroke()}))})),Vt.set(this,(t=>{const i=e.get("layer1");o(i)(((e,i)=>{e.setTransform(1,0,0,1,i.width/2-100,i.height/2+40+2*Math.sin(t/60)),e.font=v(12),e.fillText("Press spacebar to act",0,0)}))})),Zt.set(this,(t=>{t.fillStyle="white",t.fillRect(this.hitBoxes.start.left,this.hitBoxes.start.top,this.hitBoxes.start.width,this.hitBoxes.start.height),t.fillRect(this.hitBoxes.sound.left,this.hitBoxes.sound.top,this.hitBoxes.sound.width,this.hitBoxes.sound.height),t.fillStyle="#000"}))}}Ft=new WeakMap,Gt=new WeakMap,Dt=new WeakMap,Kt=new WeakMap,Ut=new WeakMap,Jt=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,Zt=new WeakMap;const ee=[[[.5,0,320,,.1,.5,,,,,20]],[[[,-.1,6,,18,,13,,11,,,,11,,9,,8,,,,6,,4,,6,,6,,,,,]]],[0],96];var ie,se,oe,he,ne,re=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};class ae{constructor(){this.start=()=>{this.stage=1,this.music.play(!1),re(this,ie,"f").call(this),re(this,he,"f").call(this)},this.update=t=>{const i=e.get("layer1");o(i)(((t,e)=>{t.setTransform(1,0,0,1,e.width/2,e.height/2),t.font=v(64),t.fillText("Game Over",-260,-120)}))},this.end=()=>{this.music.stop(),re(this,ne,"f").call(this),this.elements.buttonContainer.remove()},ie.set(this,(()=>{const t=document.createElement("div");t.style.cssText="\n      display: flex;  \n      width: 480px;\n      margin: 480px auto 0;\n      justify-content: space-between;\n    ";const e=document.createElement("button");e.style.cssText="\n      background: none;\n      border: none;\n      font-size: 40px;\n      z-index: 1;\n    ",e.textContent="Retry";const i=document.createElement("button");i.style.cssText="\n      background: none;\n      border: none;\n      font-size: 40px;\n      z-index: 1;\n    ",i.textContent="Main Menu",t.append(e),t.append(i),document.body.append(t),this.elements={buttonContainer:t,menuButton:i,retryButton:e}})),se.set(this,(()=>{h({type:"change-scene",payload:{type:"play",state:Xt[this.stage]}})})),oe.set(this,(()=>{h({type:"change-scene",payload:{type:"title",state:null}})})),he.set(this,(()=>{this.elements.retryButton.addEventListener("click",re(this,se,"f")),this.elements.menuButton.addEventListener("click",re(this,oe,"f"))})),ne.set(this,(()=>{this.elements.retryButton.removeEventListener("click",re(this,se,"f")),this.elements.menuButton.removeEventListener("click",re(this,oe,"f"))})),this.music=new jt(ee)}}ie=new WeakMap,se=new WeakMap,oe=new WeakMap,he=new WeakMap,ne=new WeakMap;var le,ce,fe,de=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};le=new WeakMap,ce=new WeakMap,fe=new WeakMap,i("layer1"),i("layer2"),i("layer3"),i("bg"),(new class{constructor(){this.start=()=>{this.scenes[this.activeScene].start(),requestAnimationFrame(de(this,ce,"f")),de(this,fe,"f").call(this)},le.set(this,((t,e)=>{this.scenes[this.activeScene].end(),this.activeScene=t,this.scenes[this.activeScene].start(e)})),ce.set(this,(e=>{[...t.values()].map((t=>(t=>{const e=t.getContext("2d");return()=>{e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)}})(t)())),this.scenes[this.activeScene].update(e),requestAnimationFrame(de(this,ce,"f"))})),fe.set(this,(()=>{var t;t=({type:t,payload:e})=>{"change-scene"===t&&de(this,le,"f").call(this,e.type,e.state)},window.addEventListener("message",(e=>{e.data&&t(e.data)}))})),this.activeScene="title",this.scenes={play:new qt,title:new te,gameover:new ae}}}).start()})();